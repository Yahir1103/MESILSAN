<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Front – Plan & Historial (Dark)</title>
  <style>
    /* ESTILOS AISLADOS CON ALTA ESPECIFICIDAD - COMPACTOS PARA UNA PANTALLA */
    #app-mes-front-isolated {
      --bg: #32323E !important;
      --panel: #34334E !important;
      --panel-2: #2c3e50 !important;
      --ink: #dfe6eb !important;
      --muted: #95a5a6 !important;
      --line: #20688C !important;
      --btn-blue: #3498db !important;
      --btn-red: #e74c3c !important;
      --btn-gray: #3C3940 !important;
      --btn-green: #456636 !important;
      --btn-orange: #e67e22 !important;
      --btn-cyan: #2980b9 !important;
      --btn-purple: #502696 !important;
      
      background-color: var(--bg) !important;
      color: var(--ink) !important;
      padding: 8px !important;
      max-width: 1600px !important;
      margin: 0 auto !important;
      min-height: 100vh !important;
      font-family: "Segoe UI", Inter, system-ui, -apple-system, Roboto, Arial, sans-serif !important;
      box-sizing: border-box !important;
    }

    /* UTILIDADES */
    #app-mes-front-isolated .row {
      display: grid !important;
      gap: 6px !important;
    }

    #app-mes-front-isolated .row.cols-2 {
      grid-template-columns: 1fr 1fr !important;
    }

    #app-mes-front-isolated .row.cols-3 {
      grid-template-columns: 1fr 1fr 1fr !important;
    }

    #app-mes-front-isolated .spacer {
      height: 4px !important;
    }

    #app-mes-front-isolated .right {
      margin-left: auto !important;
    }

    /* PANELES */
    #app-mes-front-isolated .panel {
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%) !important;
      border: 1px solid var(--line) !important;
      border-radius: 4px !important;
      overflow: hidden !important;
      position: relative !important;
      box-shadow: 0 0 0 1px rgba(32,104,140,.25), 0 4px 12px rgba(0,0,0,.35) !important;
      margin-bottom: 6px !important;
    }

    #app-mes-front-isolated .panel-header {
      display: flex !important;
      align-items: center !important;
      gap: 6px !important;
      padding: 6px 8px !important;
      background: var(--header) !important;
      border-bottom: 1px solid rgba(32,104,140,.6) !important;
      font-weight: 600 !important;
      letter-spacing: 0.1px !important;
    }

    #app-mes-front-isolated .panel-header .title {
      font-size: 12px !important;
      color: var(--ink) !important;
      font-weight: 600 !important;
    }

    #app-mes-front-isolated .panel-body {
      padding: 6px !important;
      background: transparent !important;
    }

    /* CONTROLES */
    #app-mes-front-isolated label {
      font-size: 10px !important;
      color: var(--muted) !important;
      display: block !important;
      margin-bottom: 2px !important;
      font-weight: 500 !important;
    }

    #app-mes-front-isolated .toolbar {
      display: grid !important;
      grid-template-columns: 1fr auto !important;
      align-items: center !important;
      gap: 8px !important;
    }

    #app-mes-front-isolated .inputs {
      display: grid !important;
      grid-template-columns: repeat(12, minmax(0,1fr)) !important;
      gap: 6px !important;
      align-items: end !important;
    }

    #app-mes-front-isolated .field {
      display: flex !important;
      flex-direction: column !important;
    }

    #app-mes-front-isolated .field.inline {
      display: grid !important;
      grid-template-columns: 100px 1fr !important;
      align-items: center !important;
      column-gap: 8px !important;
      min-width: 0 !important;
    }

    #app-mes-front-isolated .field.inline > label {
      display: block !important;
      margin: 0 !important;
      text-align: left !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
    }

    #app-mes-front-isolated .field.inline input[type="text"],
    #app-mes-front-isolated .field.inline input[type="date"],
    #app-mes-front-isolated .field.inline select {
      width: 100% !important;
    }

    #app-mes-front-isolated input[type="text"],
    #app-mes-front-isolated input[type="date"],
    #app-mes-front-isolated select {
      background: #0b1426 !important;
      color: var(--ink) !important;
      border: 1px solid rgba(32,104,140,.8) !important;
      border-radius: 3px !important;
      padding: 4px 6px !important;
      outline: none !important;
      font-size: 11px !important;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.25) !important;
      font-family: inherit !important;
      box-sizing: border-box !important;
      display: block !important;
    }

    #app-mes-front-isolated input[type="date"] {
      width: 120px !important;
    }

    #app-mes-front-isolated select {
      min-width: 80px !important;
    }

    #app-mes-front-isolated .controls-right {
      display: flex !important;
      gap: 4px !important;
    }

    /* BOTONES */
    #app-mes-front-isolated .btn {
      border: 1px solid var(--line) !important;
      border-radius: 3px !important;
      padding: 4px 8px !important;
      font-weight: 600 !important;
      font-size: 10px !important;
      color: #fff !important;
      cursor: pointer !important;
      background: var(--btn-gray) !important;
      font-family: inherit !important;
      display: inline-block !important;
      text-align: center !important;
      line-height: 1.1 !important;
      box-sizing: border-box !important;
      text-decoration: none !important;
      transition: all 0.2s ease !important;
    }

    #app-mes-front-isolated .btn:hover {
      transform: translateY(-1px) !important;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3) !important;
    }

    #app-mes-front-isolated .btn:active {
      transform: translateY(1px) !important;
    }

    #app-mes-front-isolated .btn.blue {
      background: var(--btn-blue) !important;
      border-color: var(--btn-blue) !important;
    }

    #app-mes-front-isolated .btn.red {
      background: var(--btn-red) !important;
      border-color: var(--btn-red) !important;
    }

    #app-mes-front-isolated .btn.gray {
      background: var(--btn-gray) !important;
      border-color: var(--btn-gray) !important;
    }

    #app-mes-front-isolated .btn.green {
      background: var(--btn-green) !important;
      border-color: var(--btn-green) !important;
    }

    #app-mes-front-isolated .btn.orange {
      background: var(--btn-orange) !important;
      border-color: var(--btn-orange) !important;
    }

    #app-mes-front-isolated .btn.cyan {
      background: var(--btn-cyan) !important;
      border-color: var(--btn-cyan) !important;
    }

    #app-mes-front-isolated .btn.purple {
      background: var(--btn-purple) !important;
      border-color: var(--btn-purple) !important;
    }

    /* TABLAS */
    #app-mes-front-isolated .table {
      border: 1px solid var(--line) !important;
      border-radius: 4px !important;
      overflow: hidden !important;
      background: #40424F !important;
      width: 100% !important;
    }

    /* ESTILOS PARA TABLAS VACÍAS */
    #app-mes-front-isolated .table .placeholder {
      height: 120px !important;
      display: grid !important;
      place-items: center !important;
      color: #95a5a6 !important;
      font-weight: 600 !important;
      background: linear-gradient(135deg, #40424F 0%, #3a3d4a 100%) !important;
      font-size: 11px !important;
      border: 1px dashed #5F6375 !important;
      border-radius: 4px !important;
      margin: 4px !important;
    }

    /* FORZAR COLORES DE CELDAS */
    #app-mes-front-isolated table td,
    #app-mes-front-isolated .table td {
      background: inherit !important;
      background-color: inherit !important;
      color: #dfe6eb !important;
    }

    /* ESTILOS CSS AGRESIVOS PARA EVITAR INTERFERENCIA GLOBAL */
    #app-mes-front-isolated *[class*="table"] thead,
    #app-mes-front-isolated *[class*="table"] thead tr,
    #app-mes-front-isolated *[class*="table"] thead th,
    #app-mes-front-isolated *[id*="table"] thead,
    #app-mes-front-isolated *[id*="table"] thead tr,
    #app-mes-front-isolated *[id*="table"] thead th {
      background: #172A46 !important;
      background-color: #172A46 !important;
      color: #ecf0f1 !important;
    }

    #app-mes-front-isolated *[class*="table"] tbody,
    #app-mes-front-isolated *[class*="table"] tbody tr,
    #app-mes-front-isolated *[id*="table"] tbody,
    #app-mes-front-isolated *[id*="table"] tbody tr {
      background: #40424F !important;
      background-color: #40424F !important;
    }

    #app-mes-front-isolated *[class*="table"] tbody tr:nth-child(even),
    #app-mes-front-isolated *[id*="table"] tbody tr:nth-child(even) {
      background: #44475A !important;
      background-color: #44475A !important;
    }

    /* SOBRESCRIBIR CUALQUIER ESTILO GLOBAL DE TABLAS */
    #app-mes-front-isolated table,
    #app-mes-front-isolated .table {
      background: #40424F !important;
      background-color: #40424F !important;
    }

    #app-mes-front-isolated table thead,
    #app-mes-front-isolated .table thead {
      background: #172A46 !important;
      background-color: #172A46 !important;
    }

    #app-mes-front-isolated table tbody,
    #app-mes-front-isolated .table tbody {
      background: #40424F !important;
      background-color: #40424F !important;
    }

    #app-mes-front-isolated .table th {
      padding: 4px 4px !important;
      text-align: left !important;
      font-size: 10px !important;
      color: #ecf0f1 !important;
      white-space: nowrap !important;
      border-right: 1px solid var(--line) !important;
      font-weight: 600 !important;
      background: #172A46 !important;
      background-color: #172A46 !important;
      box-sizing: border-box !important;
    }

    #app-mes-front-isolated .table th:last-child {
      border-right: 0 !important;
    }

    #app-mes-front-isolated .table .body {
      height: 120px !important;
      overflow: auto !important;
      background: #40424F !important;
    }

    #app-mes-front-isolated .table .placeholder {
      height: 120px !important;
      display: grid !important;
      place-items: center !important;
      color: #95a5a6 !important;
      font-weight: 600 !important;
      background: linear-gradient(135deg, #40424F 0%, #3a3d4a 100%) !important;
      font-size: 11px !important;
      border: 1px dashed #5F6375 !important;
      border-radius: 4px !important;
      margin: 4px !important;
    }

    /* ESTILOS PARA LAS CELDAS DE LA TABLA */
    #app-mes-front-isolated .table tbody {
      background: #40424F !important;
      background-color: #40424F !important;
    }

    #app-mes-front-isolated .table tbody tr {
      background-color: #40424F !important;
      background: #40424F !important;
    }

    #app-mes-front-isolated .table tbody tr:nth-child(even) {
      background-color: #44475A !important;
      background: #44475A !important;
    }

    #app-mes-front-isolated .table tbody tr:hover {
      background-color: #485563 !important;
      background: #485563 !important;
    }

    #app-mes-front-isolated .table tbody tr:nth-child(even):hover {
      background-color: #485563 !important;
      background: #485563 !important;
    }

    #app-mes-front-isolated .table td {
      padding: 4px 4px !important;
      text-align: left !important;
      font-size: 10px !important;
      color: #dfe6eb !important;
      white-space: nowrap !important;
      border-bottom: 1px solid #5F6375 !important;
      border-right: 1px solid #5F6375 !important;
      background-color: inherit !important;
      background: inherit !important;
      box-sizing: border-box !important;
    }

    #app-mes-front-isolated .table td:last-child {
      border-right: 0 !important;
    }

    #app-mes-front-isolated .table tbody tr:last-child td {
      border-bottom: 0 !important;
    }

    /* CHECKBOXES EN TABLAS */
    #app-mes-front-isolated .table input[type="checkbox"] {
      transform: scale(0.9) !important;
      cursor: pointer !important;
      accent-color: #3498db !important;
      margin: 0 !important;
    }

    #app-mes-front-isolated .table input[type="checkbox"]:checked {
      accent-color: #27ae60 !important;
    }

    #app-mes-front-isolated .table input[type="checkbox"]:not(:checked) {
      accent-color: #95a5a6 !important;
    }

    /* MEJORAS VISUALES PARA TABLAS CON DATOS */
    #app-mes-front-isolated .table tbody tr:not(:empty) {
      transition: background-color 0.2s ease !important;
    }

    #app-mes-front-isolated .table tbody tr:not(:empty):hover {
      background-color: #485563 !important;
      box-shadow: inset 0 0 0 1px rgba(52, 152, 219, 0.3) !important;
    }

    /* ESTILOS PARA CELDAS CON DATOS ESPECÍFICOS */
    #app-mes-front-isolated .table td[data-status="active"] {
      color: #27ae60 !important;
      font-weight: 600 !important;
    }

    #app-mes-front-isolated .table td[data-status="warning"] {
      color: #f39c12 !important;
      font-weight: 600 !important;
    }

    #app-mes-front-isolated .table td[data-status="error"] {
      color: #e74c3c !important;
      font-weight: 600 !important;
    }

    #app-mes-front-isolated .table td[data-type="quantity"] {
      text-align: right !important;
      font-weight: 600 !important;
      color: #3498db !important;
    }

    #app-mes-front-isolated .table td[data-type="date"] {
      color: #95a5a6 !important;
      font-size: 9px !important;
    }

    /* RESALTADO PARA FILAS IMPORTANTES */
    #app-mes-front-isolated .table tbody tr.highlight {
      background-color: rgba(52, 152, 219, 0.1) !important;
      border-left: 3px solid #3498db !important;
    }

    #app-mes-front-isolated .table tbody tr.highlight:nth-child(even) {
      background-color: rgba(52, 152, 219, 0.15) !important;
    }

    #app-mes-front-isolated .table tbody tr.highlight:hover {
      background-color: rgba(52, 152, 219, 0.2) !important;
    }

    /* MEJORAS PARA SCROLLBARS DE TABLAS */
    #app-mes-front-isolated .table .body::-webkit-scrollbar {
      width: 6px !important;
      height: 6px !important;
    }

    #app-mes-front-isolated .table .body::-webkit-scrollbar-track {
      background: #2c3e50 !important;
      border-radius: 3px !important;
    }

    #app-mes-front-isolated .table .body::-webkit-scrollbar-thumb {
      background: #3498db !important;
      border-radius: 3px !important;
    }

    #app-mes-front-isolated .table .body::-webkit-scrollbar-thumb:hover {
      background: #2980b9 !important;
    }

    #app-mes-front-isolated .footer-row {
      display: flex !important;
      justify-content: flex-start !important;
      align-items: center !important;
      padding: 4px 4px !important;
      color: #95a5a6 !important;
      font-size: 10px !important;
      background: #40424F !important;
      border-top: 1px solid var(--line) !important;
    }

    #app-mes-front-isolated .btnbar {
      display: flex !important;
      gap: 4px !important;
      flex-wrap: wrap !important;
    }

    /* SCROLLBAR */
    #app-mes-front-isolated ::-webkit-scrollbar {
      height: 6px !important;
      width: 6px !important;
    }

    #app-mes-front-isolated ::-webkit-scrollbar-track {
      background: #0e1a2e !important;
    }

    #app-mes-front-isolated ::-webkit-scrollbar-thumb {
      background: #29506b !important;
      border-radius: 6px !important;
    }

    /* ESTILOS PARA BARRAS DE PROGRESO Y TAGS DE ESTADO */
    #app-mes-front-isolated .progress-bar {
      height: 12px !important;
      background: #2c3e50 !important;
      border-radius: 6px !important;
      overflow: hidden !important;
      border: 1px solid var(--line) !important;
      position: relative !important;
      min-width: 80px !important;
    }

    #app-mes-front-isolated .progress-bar > span {
      display: block !important;
      height: 100% !important;
      background: linear-gradient(90deg, var(--btn-blue), #27ae60) !important;
      transition: width 0.5s ease !important;
      border-radius: 5px !important;
    }

    #app-mes-front-isolated .status-tag {
      display: inline-block !important;
      padding: 2px 6px !important;
      border-radius: 8px !important;
      font-size: 9px !important;
      font-weight: 500 !important;
      text-align: center !important;
      min-width: 35px !important;
      border: 1px solid transparent !important;
    }

    #app-mes-front-isolated .status-tag.completed {
      background: rgba(39, 174, 96, 0.15) !important;
      border-color: rgba(39, 174, 96, 0.5) !important;
      color: #27ae60 !important;
    }

    #app-mes-front-isolated .status-tag.partial {
      background: rgba(243, 156, 18, 0.12) !important;
      border-color: rgba(243, 156, 18, 0.4) !important;
      color: #f39c12 !important;
    }

    #app-mes-front-isolated .status-tag.pending {
      background: rgba(231, 76, 60, 0.12) !important;
      border-color: rgba(231, 76, 60, 0.4) !important;
      color: #e74c3c !important;
    }

    #app-mes-front-isolated .table td.mono {
      font-family: ui-monospace, 'SFMono-Regular', 'Menlo', 'Consolas', monospace !important;
      text-align: center !important;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      #app-mes-front-isolated {
        padding: 4px !important;
      }

      #app-mes-front-isolated .row.cols-2,
      #app-mes-front-isolated .row.cols-3 {
        grid-template-columns: 1fr !important;
      }

      #app-mes-front-isolated .inputs {
        grid-template-columns: 1fr !important;
        gap: 4px !important;
      }

      #app-mes-front-isolated .field.inline {
        grid-template-columns: 1fr !important;
        gap: 2px !important;
      }

      #app-mes-front-isolated .field.inline > label {
        text-align: left !important;
      }

      #app-mes-front-isolated .btnbar {
        flex-direction: column !important;
        gap: 3px !important;
      }

      #app-mes-front-isolated .btn {
        width: 100% !important;
        padding: 6px 8px !important;
        font-size: 10px !important;
      }

      #app-mes-front-isolated .table .body {
        height: 80px !important;
      }

      #app-mes-front-isolated .table .placeholder {
        height: 80px !important;
      }
    }

    @media (max-width: 480px) {
      #app-mes-front-isolated {
        padding: 2px !important;
      }

      #app-mes-front-isolated .panel-body {
        padding: 4px !important;
      }

      #app-mes-front-isolated .btn {
        padding: 4px 6px !important;
        font-size: 9px !important;
      }

      #app-mes-front-isolated .table .body {
        height: 60px !important;
      }

      #app-mes-front-isolated .table .placeholder {
        height: 60px !important;
      }
    }
  </style>
</head>
<body>
  <div id="app-mes-front-isolated">

    <!-- =================== BARRA SUPERIOR =================== -->
    <section class="panel" id="panel-top">
      <div class="panel-body toolbar">
        <div class="inputs">
          <div class="field inline" style="grid-column: span 2" id="fld-lot-no">
            <label for="lotNo">Lot No</label>
            <input id="lotNo" type="text" placeholder="" />
          </div>
          <div class="field inline" style="grid-column: span 2" id="fld-lot-no-info">
            <label for="lotNoInfo">Lot No Info</label>
            <input id="lotNoInfo" type="text" placeholder="" />
          </div>
          <div class="field inline" style="grid-column: span 5" id="fld-blank-spacer">
            <label>&nbsp;</label>
            <input type="text" placeholder="" />
          </div>
          <div class="controls-right" style="grid-column: span 3" id="ctrl-start-stop">
            <button class="btn blue" id="btn-start">Start(Re-Start)</button>
            <button class="btn red" id="btn-end">End</button>
            <button class="btn gray" id="btn-stop">Stop</button>
          </div>
        </div>
      </div>
    </section>

    <div class="spacer"></div>

    <!-- =================== FILTROS + TABLA PRINCIPAL =================== -->
    <section class="panel" id="panel-plan">
      <div class="panel-body">
        <div class="toolbar" style="margin-bottom:6px">
          <div class="inputs" style="grid-template-columns:repeat(16,minmax(0,1fr))">
            <div class="field inline" style="grid-column: span 6" id="fld-prod-date">
              <label>Production Date</label>
              <div style="display:grid; grid-auto-flow:column; grid-auto-columns:max-content; align-items:center; column-gap:6px; min-width:0">
                <input type="date" id="dateFrom" />
                <span style="color:var(--muted)">~</span>
                <input type="date" id="dateTo" />
              </div>
            </div>
            <div class="field inline" style="grid-column: span 3" id="fld-line">
              <label for="selLine">Line</label>
              <div style="display:grid; grid-auto-flow:column; grid-auto-columns:max-content; align-items:center; column-gap:6px">
                <select id="selLine">
                  <option>ALL</option>
                </select>
                <button class="btn gray" title="Clear" id="btn-clear-line">x</button>
              </div>
            </div>
            <div class="right controls-right" style="grid-column: 13 / span 4" id="ctrl-search-export">
              <button class="btn gray" id="btn-search">Search</button>
              <button class="btn green" id="btn-export-main">Excel Export</button>
            </div>
          </div>
        </div>

        <!-- Tabla principal -->
        <div class="table" id="tbl-plan">
          <table style="width:100%; border-collapse:collapse">
            <thead>
              <tr>
                <th style="width:30px"><input type="checkbox" aria-label="select-all"/></th>
                <th style="width:60px">ID</th>
                <th style="width:80px">Line</th>
                <th style="width:100px">Lot No</th>
                <th style="width:100px">NParte</th>
                <th style="width:100px">Model</th>
                <th style="width:80px">Type</th>
                <th style="width:80px">Shift</th>
                <th style="width:60px">CT</th>
                <th style="width:60px">UPH</th>
                <th style="width:80px">Qty</th>
                <th style="width:80px">Produced</th>
                <th style="width:60px">Missing</th>
                <th style="width:60px">%</th>
                <th style="width:100px">Progress</th>
                <th style="width:120px">Created</th>
                <th style="width:80px">User</th>
                <th style="width:120px">Comments</th>
              </tr>
            </thead>
            <tbody id="tbody-plan-data">
            </tbody>
          </table>
          <div class="placeholder" id="plan-placeholder">Loading data...</div>
        </div>
      </div>
    </section>

    <div class="spacer"></div>

    <!-- =================== SEGUNDA FILA: 2 PANELES =================== -->
    <div class="row cols-2">
      <!-- Bom List -->
      <section class="panel" id="panel-bom">
        <div class="panel-header">
          <span class="title">Bom List</span>
          <div class="right btnbar">
            <button class="btn green" id="btn-bom-export">Excel Export</button>
            <button class="btn gray" id="btn-verification-pass">Verification Pass</button>
            <button class="btn orange" id="btn-alt-mat">Alternative material registration</button>
            <button class="btn cyan" id="btn-merge-slots">Merge Slots</button>
          </div>
        </div>
        <div class="panel-body">
          <div class="table" id="tbl-bom">
            <table style="width:100%; border-collapse:collapse">
              <thead>
                <tr>
                  <th style="width:24px"><input type="checkbox" aria-label="select-all"/></th>
                  <th>Equip...</th>
                  <th>Slot No</th>
                  <th>Materia...</th>
                  <th>Part Nu...</th>
                  <th>Incorre...</th>
                  <th>batch i...</th>
                  <th>Verifica...</th>
                  <th>Merge...</th>
                  <th>Alter M...</th>
                  <th>Remain...</th>
                </tr>
              </thead>
            </table>
            <div class="placeholder">No data</div>
          </div>
          <div class="footer-row">Total Rows : 0</div>
        </div>
      </section>

      <!-- Material Changed History -->
      <section class="panel" id="panel-mch">
        <div class="panel-header">
          <span class="title">Material Changed History</span>
          <div class="right btnbar">
            <button class="btn green" id="btn-mch-export">Excel Export</button>
          </div>
        </div>
        <div class="panel-body">
          <div class="table" id="tbl-mch">
            <table style="width:100%; border-collapse:collapse">
              <thead>
                <tr>
                  <th>Equipment...</th>
                  <th>Slot No</th>
                  <th>Regist Date</th>
                  <th>Warehousing...</th>
                  <th>Regist Quan...</th>
                  <th>Current Qu...</th>
                </tr>
              </thead>
            </table>
            <div class="placeholder">No data</div>
          </div>
          <div class="footer-row">Total Rows : 0</div>
        </div>
      </section>
    </div>

    <div class="spacer"></div>

    <!-- =================== TERCERA FILA: 3 PANELES =================== -->
    <div class="row cols-3">
      <!-- Solder History -->
      <section class="panel" id="panel-solder">
        <div class="panel-header">
          <span class="title">Solder History</span>
          <div class="right btnbar">
            <button class="btn purple" id="btn-solder-regist">Regist</button>
            <button class="btn green" id="btn-solder-export">Excel Export</button>
          </div>
        </div>
        <div class="panel-body">
          <div class="table" id="tbl-solder">
            <table style="width:100%; border-collapse:collapse">
              <thead>
                <tr>
                  <th>Regist D...</th>
                  <th>Solder S...</th>
                  <th>Remainin...</th>
                  <th>Effective...</th>
                  <th>Status</th>
                </tr>
              </thead>
            </table>
            <div class="placeholder">No data</div>
          </div>
        </div>
      </section>

      <!-- Metalmask History -->
      <section class="panel" id="panel-metalmask">
        <div class="panel-header">
          <span class="title">Metalmask History</span>
          <div class="right btnbar">
            <button class="btn purple" id="btn-metalmask-regist">Regist</button>
            <button class="btn green" id="btn-metalmask-export">Excel Export</button>
          </div>
        </div>
        <div class="panel-body">
          <div class="table" id="tbl-metalmask">
            <table style="width:100%; border-collapse:collapse">
              <thead>
                <tr>
                  <th>Regist Date</th>
                  <th>Manage No</th>
                  <th>Available Q...</th>
                </tr>
              </thead>
            </table>
            <div class="placeholder">No data</div>
          </div>
        </div>
      </section>

      <!-- Squeegee History -->
      <section class="panel" id="panel-squeegee">
        <div class="panel-header">
          <span class="title">Squeegee History</span>
          <div class="right btnbar">
            <button class="btn purple" id="btn-squeegee-regist">Regist</button>
            <button class="btn green" id="btn-squeegee-export">Excel Export</button>
          </div>
        </div>
        <div class="panel-body">
          <div class="table" id="tbl-squeegee">
            <table style="width:100%; border-collapse:collapse">
              <thead>
                <tr>
                  <th>Regist Date</th>
                  <th>Front Manage...</th>
                  <th>Front Available...</th>
                  <th>Rear Manage...</th>
                  <th>Rear Available...</th>
                </tr>
              </thead>
            </table>
            <div class="placeholder">No data</div>
          </div>
        </div>
      </section>
    </div>

    <div class="spacer" style="height:15px"></div>
  </div>

  <script>
    // Control de Operación Línea SMT - Integración con Plan SMD
    (function() {
      console.log('🚀 Inicializando Control de Operación Línea SMT AJAX...');
      
      // Variables globales
      let currentPlanData = [];
      let autoRefreshInterval = null;
      let isInitialized = false;
      
      // Elementos del DOM
      const elements = {
        tableBody: null,
        placeholder: null,
        dateFrom: null,
        dateTo: null,
        selLine: null,
        btnSearch: null
      };
      
      // Función para obtener elementos del DOM
      function getElements() {
        elements.tableBody = document.getElementById('tbody-plan-data');
        elements.placeholder = document.getElementById('plan-placeholder');
        elements.dateFrom = document.getElementById('dateFrom');
        elements.dateTo = document.getElementById('dateTo');
        elements.selLine = document.getElementById('selLine');
        elements.btnSearch = document.getElementById('btn-search');
        
        return elements.tableBody && elements.placeholder;
      }
      
      // Función para cargar datos del plan SMD
      async function cargarDatosPlanSMD() {
        if (!getElements()) {
          console.warn('⚠️ Elementos no encontrados, reintentando...');
          setTimeout(cargarDatosPlanSMD, 1000);
          return;
        }
        
        try {
          // Usar fecha actual si no hay fechas seleccionadas
          let dateParam = '';
          if (elements.dateFrom && elements.dateFrom.value) {
            dateParam = elements.dateFrom.value;
          } else {
            dateParam = new Date().toISOString().slice(0, 10);
          }
          
          const url = `/api/plan-smd-diario?date=${dateParam}`;
          console.log('🔄 Cargando datos desde:', url);
          
          // Mostrar estado de carga
          elements.placeholder.textContent = 'Loading data...';
          elements.placeholder.style.display = 'grid';
          
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          const data = await response.json();
          currentPlanData = data;
          
          console.log('✅ Datos cargados:', data.length, 'registros');
          
          // Ocultar placeholder si hay datos
          if (data.length > 0) {
            elements.placeholder.style.display = 'none';
          } else {
            elements.placeholder.textContent = 'No data available for selected date';
            elements.placeholder.style.display = 'grid';
          }
          
          // Renderizar datos
          renderPlanData(data);
          
        } catch (error) {
          console.error('❌ Error cargando datos:', error);
          elements.placeholder.textContent = `Error loading data: ${error.message}`;
          elements.placeholder.style.display = 'grid';
        }
      }
      
      // Función para renderizar los datos en la tabla
      function renderPlanData(data) {
        if (!elements.tableBody) return;
        
        // Limpiar tabla
        elements.tableBody.innerHTML = '';
        
        data.forEach((item, index) => {
          const pct = Math.min(100, Math.round(((item.producido || 0) / (item.qty || 1)) * 100));
          const falta = Math.max(0, (item.qty || 0) - (item.producido || 0));
          
          let statusClass = 'pending';
          if (pct >= 100) statusClass = 'completed';
          else if (pct > 0) statusClass = 'partial';
          
          const row = document.createElement('tr');
          if (pct >= 100) row.classList.add('highlight');
          
          row.innerHTML = `
            <td><input type="checkbox" data-id="${item.id}"></td>
            <td class="mono">${item.id || ''}</td>
            <td>${item.linea || ''}</td>
            <td class="mono">${item.lote || ''}</td>
            <td class="mono">${item.nparte || ''}</td>
            <td>${item.modelo || ''}</td>
            <td>${item.tipo || ''}</td>
            <td><span class="status-tag ${statusClass}">${item.turno || ''}</span></td>
            <td>${item.ct || ''}</td>
            <td>${item.uph || ''}</td>
            <td class="mono" data-type="quantity">${item.qty || 0}</td>
            <td class="mono" data-type="quantity" data-status="${statusClass === 'completed' ? 'active' : statusClass === 'partial' ? 'warning' : 'error'}">${item.producido || 0}</td>
            <td class="mono" data-type="quantity">${falta}</td>
            <td><span class="status-tag ${statusClass}">${pct}%</span></td>
            <td><div class="progress-bar"><span style="width:${pct}%"></span></div></td>
            <td class="mono" data-type="date">${item.fecha_creacion ? item.fecha_creacion.substring(0, 16) : ''}</td>
            <td>${item.usuario_creacion || ''}</td>
            <td>${item.comentarios || ''}</td>
          `;
          
          elements.tableBody.appendChild(row);
        });
      }
      
      // Función para configurar las fechas por defecto
      function setupDefaultDates() {
        if (elements.dateFrom && elements.dateTo) {
          const today = new Date().toISOString().slice(0, 10);
          if (!elements.dateFrom.value) elements.dateFrom.value = today;
          if (!elements.dateTo.value) elements.dateTo.value = today;
        }
      }
      
      // Función para configurar event listeners
      function setupEventListeners() {
        if (!getElements()) return;
        
        // Botón de búsqueda
        if (elements.btnSearch) {
          elements.btnSearch.addEventListener('click', () => {
            console.log('🔍 Búsqueda manual iniciada');
            cargarDatosPlanSMD();
          });
        }
        
        // Cambio en fechas
        if (elements.dateFrom) {
          elements.dateFrom.addEventListener('change', () => {
            console.log('📅 Fecha desde cambiada:', elements.dateFrom.value);
            cargarDatosPlanSMD();
          });
        }
        
        if (elements.dateTo) {
          elements.dateTo.addEventListener('change', () => {
            console.log('📅 Fecha hasta cambiada:', elements.dateTo.value);
            cargarDatosPlanSMD();
          });
        }
        
        // Otros botones
        const btnStart = document.getElementById('btn-start');
        const btnEnd = document.getElementById('btn-end');
        const btnStop = document.getElementById('btn-stop');
        
        if (btnStart) {
          btnStart.addEventListener('click', () => {
            console.log('▶️ Start/Restart clicked');
            cargarDatosPlanSMD();
          });
        }
        
        if (btnEnd) {
          btnEnd.addEventListener('click', () => {
            console.log('⏹️ End clicked');
          });
        }
        
        if (btnStop) {
          btnStop.addEventListener('click', () => {
            console.log('⏸️ Stop clicked');
          });
        }
      }
      
      // Función principal de inicialización
      function inicializar() {
        if (isInitialized) {
          console.log('⚠️ Ya inicializado, omitiendo...');
          return;
        }
        
        console.log('✅ Inicializando Control de Operación SMT AJAX...');
        isInitialized = true;
        
        // Configurar fechas por defecto
        setupDefaultDates();
        
        // Configurar event listeners
        setupEventListeners();
        
        // Cargar datos iniciales
        setTimeout(cargarDatosPlanSMD, 500);
        
        // Auto-refresh cada 30 segundos
        autoRefreshInterval = setInterval(cargarDatosPlanSMD, 30000);
      }
      
      // Función para reiniciar (para carga dinámica)
      window.reiniciarControlOperacionSMTAjax = function() {
        console.log('🔄 Reiniciando Control de Operación SMT AJAX...');
        isInitialized = false;
        if (autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
        }
        setTimeout(inicializar, 200);
      };
      
      // Función para verificar estado
      window.verificarControlOperacionSMTAjax = function() {
        const container = document.getElementById('app-mes-front-isolated');
        const table = document.getElementById('tbl-plan');
        const tbody = document.getElementById('tbody-plan-data');
        
        console.log('🔍 Verificando estado:');
        console.log('- Contenedor:', !!container);
        console.log('- Tabla:', !!table);
        console.log('- Tbody:', !!tbody);
        console.log('- Datos cargados:', currentPlanData.length);
        
        return !!(container && table && tbody);
      };
      
      // Auto-inicialización
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', inicializar);
      } else {
        setTimeout(inicializar, 100);
      }
      
      // Observador de mutaciones para detectar carga dinámica
      if (typeof MutationObserver !== 'undefined') {
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'childList') {
              const container = document.getElementById('app-mes-front-isolated');
              if (container && !isInitialized) {
                console.log('🔍 Detectado contenido dinámico, inicializando...');
                setTimeout(inicializar, 300);
              }
            }
          });
        });
        
        observer.observe(document.body, {
          childList: true,
          subtree: true
        });
      }
      
      // Callback para sistemas de templates
      if (typeof window.onTemplateLoaded === 'function') {
        window.onTemplateLoaded('control_operacion_linea_smt_ajax');
      }
      
    })();
  </script>
</body>
</html>
