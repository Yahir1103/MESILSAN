<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test AJAX Manager - MESILSANLOCAL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #32323E;
            padding: 20px;
            border-radius: 8px;
        }
        .test-button {
            background: #20688C;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #1a5a7a;
        }
        .log-container {
            background: #2D363D;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        .content-target {
            background: #2D363D;
            padding: 20px;
            border-radius: 4px;
            margin: 20px 0;
            min-height: 200px;
            position: relative;
        }
        .test-info {
            background: #20688C;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test AJAX Content Manager</h1>
        
        <div class="test-info">
            <h3>Caracter√≠sticas del sistema mejorado:</h3>
            <ul>
                <li>‚úÖ Carga CSS ANTES de mostrar HTML</li>
                <li>‚úÖ Modal de carga profesional con animaci√≥n</li>
                <li>‚úÖ Indicadores de progreso en tiempo real</li>
                <li>‚úÖ Delay adicional de 2 segundos para estabilidad</li>
                <li>‚úÖ Transici√≥n suave con fade-in</li>
                <li>‚úÖ Elimina COMPLETAMENTE parpadeos (FOUC)</li>
                <li>‚úÖ Logs detallados en consola</li>
            </ul>
            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 4px; margin-top: 10px;">
                <strong>‚è∞ Tiempo total de carga:</strong> ~3-4 segundos<br>
                <small>Incluye carga de CSS + delay de seguridad de 2s</small>
            </div>
        </div>

        <div>
            <h3>Acciones de prueba:</h3>
            <button class="test-button" onclick="testControlRetorno()">
                üîß Cargar Control de Retorno
            </button>
            <button class="test-button" onclick="clearContent()">
                üóëÔ∏è Limpiar Contenido
            </button>
        </div>

        <div class="log-container" id="logContainer">
            <strong>üìä Log de actividad:</strong><br>
            Presiona un bot√≥n para ver los logs de carga...
        </div>

        <div class="content-target" id="contentTarget">
            <p><strong>üéØ √Årea de contenido din√°mico</strong></p>
            <p>El contenido AJAX aparecer√° aqu√≠. Observa que:</p>
            <ul>
                <li>Primero se cargan los CSS</li>
                <li>Luego aparece el HTML con estilos aplicados</li>
                <li>No hay parpadeos ni contenido sin formato</li>
            </ul>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/ajax-content-manager.js') }}"></script>
    <script>
        // Capturar logs de consola para mostrar en pantalla
        const originalLog = console.log;
        const originalError = console.error;
        const logContainer = document.getElementById('logContainer');
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : '#4ecdc4';
            logContainer.innerHTML += `<div style="color: ${color}; margin: 2px 0;">[${timestamp}] ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };

        async function testControlRetorno() {
            addToLog('üöÄ Iniciando test de Control de Retorno con modal y delay...', 'log');
            console.log('=== TEST: Control de Retorno (con delay de 2s) ===');
            
            const startTime = Date.now();
            
            try {
                await AjaxContentManager.loadContent('/material/control_retorno', '#contentTarget');
                
                const endTime = Date.now();
                const totalTime = ((endTime - startTime) / 1000).toFixed(1);
                
                addToLog(`‚úÖ Test completado exitosamente en ${totalTime} segundos`, 'log');
                addToLog('üéØ Modal mostrado ‚Üí CSS cargado ‚Üí Delay 2s ‚Üí Contenido visible', 'log');
            } catch (error) {
                addToLog('‚ùå Error en test: ' + error.message, 'error');
            }
        }

        function clearContent() {
            document.getElementById('contentTarget').innerHTML = `
                <p><strong>üéØ √Årea de contenido din√°mico</strong></p>
                <p>Contenido limpiado. Listo para nueva prueba.</p>
            `;
            logContainer.innerHTML = '<strong>üìä Log de actividad:</strong><br>Contenido limpiado.';
            console.log('üßπ Contenido limpiado');
        }

        // Log inicial
        addToLog('üîÑ P√°gina de test cargada y lista', 'log');
        console.log('AjaxContentManager disponible:', typeof AjaxContentManager !== 'undefined');
    </script>
</body>
</html>
