<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ilsan Electronics</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Sistema de Ejecución de Manufactura para Ilsan Electronics">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ISEMM MES">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="ISEMM MES">
    <meta name="msapplication-TileColor" content="#32323E">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/static/logo.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../static/logo.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../static/logo.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/logo.png">
    <link rel="shortcut icon" href="../static/logo.png">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Font LG Regular - COMENTADO: Problema MIME -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yahirmonogatari/lg-fonts/lg-regular.css"> -->
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/styleHeader.css">
    <link rel="stylesheet" href="/static/css/responsive-mobile.css">
    
    <style>
        /* ESTILOS ESPECÍFICOS PARA PREVENIR PROBLEMAS DE DROPDOWN */
        .dropdown-menu {
            /* Prevenir que se abra automáticamente */
            display: none !important;
        }
        
        .dropdown-menu.show {
            display: block !important;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* PREVENIR ANIMACIONES CONFLICTIVAS */
        .collapse.collapsing {
            transition: none !important;
        }
        
        /* ASEGURAR QUE LOS DROPDOWNS CERRADOS PERMANEZCAN CERRADOS */
        .collapse:not(.show) {
            display: none !important;
        }
        
        .collapse.show {
            display: block !important;
        }
        
        /* BOTONES DE DROPDOWN MEJORADOS */
        .btn[data-bs-toggle="collapse"]:after {
            content: '▼';
            margin-left: 8px;
            transition: transform 0.3s ease;
        }
        
        .btn[data-bs-toggle="collapse"][aria-expanded="true"]:after {
            transform: rotate(180deg);
        }
        
        /* PREVENIR MULTIPLE ANIMACIONES EN COLLAPSE */
        [data-bs-toggle="collapse"] {
            pointer-events: auto;
        }
        
        [data-bs-toggle="collapse"].disabled {
            pointer-events: none;
        }
        
        /* BOTÓN DE LOGOUT FIJO EN LA ESQUINA SUPERIOR DERECHA */
        .logout-button-fixed {
            position: fixed;
            top: 30px;
            right: 15px;
            z-index: 9999;
            background: linear-gradient(135deg, #833c0d 0%, #6d3010 100%);
            border: 2px solid #833c0d;
            border-radius: 8px;
            padding: 8px 16px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(131, 60, 13, 0.3);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .logout-button-fixed:hover {
            background: linear-gradient(135deg, #6d3010 0%, #5a2708 100%);
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(131, 60, 13, 0.4);
            color: white;
        }
        
        .logout-button-fixed i {
            font-size: 16px;
        }
        
        /* Responsive para móviles */
        @media (max-width: 768px) {
            .logout-button-fixed {
                top: 35px;
                right: 10px;
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .logout-button-fixed i {
                font-size: 14px;
            }
        }
    </style>
    
    <!-- Sistema de Permisos Dropdowns -->
    <script src="/static/js/permisos-dropdowns.js"></script>
    <!-- <script src="../static/js/permisos-botones.js"></script> COMENTADO: Versión con problemas -->
    <script src="/static/js/permisos-botones-simple.js"></script>
    <script src="/static/js/scriptMain.js"></script>
    
</head>
<body>
    
    <div class="main-wrapper"></div>
    <header class="app-header">
        <div class="header-row">

            <!-- Logo y bienvenida a la izquierda -->
            <div class="container-logo-welcome-hamburguer">
            <div class="logo-welcome-container">    
                <img src="/static/logo.png" alt="Ilsan Electronics Logo" class="logo">
                <div class="welcome-text">
                    <span>Bienvenido,</span> {{ usuario }}
                                </div>
                
            </div>
            <!-- Hamburguesa solo visible en móviles -->
            <div class="conatiner-hamburguer">
                <button class="hamburger-btn" id="menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
    
                </div>
            </div>
            
                    <!-- Botones de navegación -->
            <div class="nav-buttons-container" id="nav-container">
                <button class="nav-button" id="Información Basica">
                    <img src="..\static\icons\info.png" class="icono-boton" alt="Información Básica">Información Básica
                </button>
                <button class="nav-button" id="Control de material">
                    <img src="..\static\icons\material.png" class="icono-boton" alt="Control de material">Control de material
                </button>
                <button class="nav-button" id="Control de producción">
                    <img src="..\static\icons\produccion.png" class="icono-boton" alt="Control de producción">Control de producción
                </button>
                <button class="nav-button" id="Control de proceso">
                    <img src="..\static\icons\proceso.png" class="icono-boton" alt="Control de proceso">Control de proceso
                </button>
                <button class="nav-button" id="Control de calidad">
                    <img src="..\static\icons\calidad.png" class="icono-boton" alt="Control de calidad">Control de calidad
                </button>
                <button class="nav-button" id="Control de resultados">
                    <img src="..\static\icons\resultados.png" class="icono-boton" alt="Control de resultados">Control de resultados
                </button>
                <button class="nav-button" id="Control de reporte">
                    <img src="..\static\icons\reporte.png" class="icono-boton" alt="Control de reporte">Control de reporte
                </button>
                <button class="nav-button" id="Configuración de programa">
                    <img src="..\static\icons\configuracion.png" class="icono-boton" alt="Configuración de programa">Configuración de programa
                </button>
                {% if tiene_permisos_usuarios %}
                <button class="nav-button admin-only" onclick="window.location.href='/admin/panel'">
                    <img src="..\static\icons\engrane.png" class="icono-boton" alt="Panel de Administración">Panel de Administración
                </button>
                {% endif %}
            </div>
            
            <!-- Botón de logout posicionado absolutamente a la derecha -->
            <button class="logout-button-fixed" onclick="confirmarLogout()">
                <i class="fas fa-sign-out-alt"></i> Log out
            </button>
        </div>
    </header>

<div class="block-left col-md-3">
    
</div>

    <!-- Contenedor principal para el sidebar -->
<div class="main-content-container" id="material-container" style="display: none;">
    <div class="sidebar-content" id="sidebar-content">
        <div id="informacion-basica-content">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        <div id="control-material-content" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        <div id="control-produccion-content" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        <div id="control-proceso-content" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        <div id="control-calidad-content" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        <div id="control-resultados-content" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        <div id="control-reporte-content" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        <div id="configuracion-programa-content" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
    </div>
    
    <!-- Contenedor específico para el contenido de Control de Material (LADO DERECHO) -->
    <div class="material-content-area" id="material-content-area" style="display: none;">
        <!-- Contenedor por defecto con información general -->
        <div id="material-info-container" style="display: block;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        
        <div id="control-almacen-container" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        <div id="control-salida-container" style="display: none;">
            <!-- Contenido embebido del Control de Salida para evitar problemas de carga dinámica -->
            <link rel="stylesheet" href="/static/css/control_salida_material.css">
            <link rel="stylesheet" href="/static/css/control_salida_material_responsive.css">
            
            <div class="material-toolbar">
                <!-- Contenedor izquierdo: Campo de escaneo -->
                <div class="scan-container">
                    <div class="material-form-group">
                        <label>Código de material recibido</label>
                        <input type="text" id="salida_codigo_material_recibido" placeholder="Escanear código aquí..." onkeydown="procesarEscaneoRapido(event)" autocomplete="off">
                    </div>
                </div>
                <div class="material-form-group verification-group">
                    <label>Verificación de salida (Requerido)</label>
                    <input type="text" id="salida_verificacion_codigo" placeholder="Escanear código de verificación..." onkeydown="procesarVerificacion(event)" autocomplete="off" style="border: 2px solid #e74c3c;">
                </div>

                <!-- Contenedor derecho: Checkboxes -->
                <div class="checkbox-container">
                    <label style="display: flex; align-items: center; gap: 8px; color: #ecf0f1; font-size: 12px; cursor: pointer;">
                        <input type="checkbox" id="salida_registroAutomatico" style="transform: scale(1.0); accent-color: #27ae60;" checked>
                        Registro automático
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; color: #ecf0f1; font-size: 12px; cursor: pointer;">
                        <input type="checkbox" id="salida_verificacionBOM" style="transform: scale(1.0); accent-color: #8e44ad;">
                        Verificación de BOM
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; color: #ecf0f1; font-size: 12px; cursor: pointer;">
                        <input type="checkbox" id="salida_peps" style="transform: scale(1.0); accent-color: #27ae60;">
                        PEPS
                    </label>
                </div>
            </div>
            <div class="material-form-section">
                <div class="material-form-row three-column">
                    <div class="material-form-group">
                        <label>Modelo <span style="color: #95a5a6; font-size: 11px;">(Opcional)</span></label>
                        <div class="salida-search-container">
                            <input type="text" class="salida-search-dropdown" id="salida_modelo_search" placeholder="Buscar modelo (opcional)..." onkeyup="filtrarModelosSalida()" onclick="mostrarDropdownSalida()" />
                            <div class="salida-dropdown-list" id="salidaDropdownList" style="display: none;">
                                <!-- Los modelos se cargarán dinámicamente aquí -->
                            </div>
                            <!-- Campo oculto para el valor real del modelo -->
                            <input type="hidden" id="salida_modelo" name="modelo" />
                        </div>
                    </div>
                    <div class="material-form-group">
                        <!-- Campo movido arriba -->
                    </div>
                    <div class="material-form-group">
                        <button class="material-btn secondary" id="salida_btnGuardarSalida" onclick="procesarSalidaManual()" style="display: none;">Guardar Salida</button>
                    </div>
                </div>
                <div class="material-form-row three-column">
                    <div class="material-form-group">
                        <label>Código de material original</label>
                        <input type="text" id="salida_codigo_material_original" readonly>
                    </div>
                    <div class="material-form-group">
                        <label>Código de material</label>
                        <input type="text" id="salida_codigo_material" readonly>
                    </div>
                    <div class="material-form-group">
                        <label>Especificación de material</label>
                        <input type="text" id="salida_especificacion_material" readonly>
                    </div>
                </div>
                <div class="material-form-row three-column">
                    <div class="material-form-group">
                        <label>Numero de parte</label>
                        <input type="text" id="salida_numero_parte" readonly>
                    </div>
                    <div class="material-form-group">
                        <label>Cantidad actual</label>
                        <input type="text" id="salida_cantidad_actual" readonly>
                    </div>
                    <div class="material-form-group">
                        <label>Numero de lote de material</label>
                        <input type="text" id="salida_numero_lote_material" readonly>
                    </div>
                </div>
                <div class="material-form-row three-column">
                    <div class="material-form-group">
                        <label>Fecha de salida</label>
                        <input type="date" id="salida_fecha_salida_form" value="">
                    </div>
                    <div class="material-form-group">
                        <!-- Campo vacío -->
                    </div>
                    <div class="material-form-group">
                        <!-- Campo vacío -->
                    </div>
                </div>
            </div>

            <div class="material-table-container">
                <div class="material-table-controls">
                    <button class="material-btn" id="btnRegistroSalida" onclick="mostrarRegistroSalida()">Registro de salida</button>
                    <button class="material-btn" id="btnHistorialSalida" onclick="mostrarHistorialSalida()">Historial de salida</button>
                    
                    <!-- Control de Plan -->
                    <div class="plan-control" style="display: flex; align-items: center; gap: 10px; margin-left: auto;">
                        <label style="color: #ecf0f1; font-weight: 600; font-size: 14px;">Plan:</label>
                        <input type="text" id="plan_cantidad" placeholder="500" value="1" 
                               style="width: 60px; padding: 4px 6px; border: 2px solid #3498db; border-radius: 4px; 
                                      background-color: #2c3e50; color: #ecf0f1; font-weight: bold; text-align: center; font-size: 12px;"
                               onchange="actualizarCantidadesPlan()" onkeyup="actualizarCantidadesPlan()">
                        <span style="color: #95a5a6; font-size: 12px;">unidades</span>
                    </div>
                </div>

                <!-- Tablas para modo Registro de salida - siempre visibles -->
                <div id="tablasRegistroSalida" class="registro-tablas-container" style="display: flex; gap: 20px; margin: 20px 0;">
                    <!-- Primera tabla - Información general del BOM -->
                    <div class="tabla-container" style="flex: 1;">
                        <h4 style="margin: 0 0 10px 0; color: #ecf0f1; font-size: 14px; font-weight: 600; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">Componentes del BOM seleccionado</h4>
                        <table class="material-table">
                            <thead>
                                <tr>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Número de parte</th>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Especificación</th>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Cantidad total</th>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">PLAN</th>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Faltantes</th>
                                </tr>
                            </thead>
                            <tbody id="tabla1BOM">
                                <tr>
                                    <td colspan="5" class="no-data" style="color: #7f8c8d; font-style: italic; text-align: center; padding: 20px;">Seleccione un modelo para ver componentes</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Divisor vertical -->
                    <div style="width: 2px; background-color: #bdc3c7; margin: 0 10px; border-radius: 1px;"></div>

                    <!-- Segunda tabla - Detalles del material seleccionado -->
                    <div class="tabla-container" style="flex: 1;">
                        <h4 style="margin: 0 0 10px 0; color: #ecf0f1; font-size: 14px; font-weight: 600; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">Material actual para salida</h4>
                        <table class="material-table">
                            <thead>
                                <tr>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Número de parte</th>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Descripción</th>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Cantidad disponible</th>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Cantidad requerida</th>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Estado</th>
                                    <th style="background-color: #34495e; color: #ecf0f1; border: 1px solid #2c3e50;">Código de material</th>
                                </tr>
                            </thead>
                            <tbody id="tabla2BOM">
                                <tr>
                                    <td colspan="6" class="no-data" style="color: #7f8c8d; font-style: italic; text-align: center; padding: 20px;">Seleccione un componente de la tabla izquierda</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Controles y tabla de historial -->
                <div id="historialSection" style="display: none;">
                    <div class="material-table-controls" id="historialControles" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center; justify-content: space-between;">
                        <!-- Filtros de fecha - lado izquierdo -->
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <div class="material-form-group">
                                <label>Fecha desde</label>
                                <input type="date" id="salida_fecha_desde">
                            </div>
                            <div class="material-form-group">
                                <label>Fecha hasta</label>
                                <input type="date" id="salida_fecha_hasta">
                            </div>
                        </div>
                        
                        <!-- Controles principales - lado derecho -->
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <div class="material-form-group">
                                <label>Código de material recibido</label>
                                <input type="text" id="salida_filtro_codigo" placeholder="Buscar por código...">
                            </div>
                            <button class="material-btn secondary" onclick="consultarSalidas()">Consultar</button>
                            <button class="material-btn" onclick="limpiarFiltros()" style="background-color: #95a5a6;">Limpiar filtros</button>
                            <button class="material-btn orange" onclick="exportarExcel()">Exportar el excel</button>
                        </div>
                    </div>
                    <table class="material-table" id="salida_tablaSalidas">
                        <thead>
                            <tr>
                                <th>Fecha de salida</th>
                                <th>Proceso de salida</th>
                                <th>Código de material recibido</th>
                                <th>Código de material</th>
                                <th>Número de parte</th>
                                <th>Disp.</th>
                                <th>Hist.</th>
                                <th>Código de material original</th>
                                <th>Número de lote</th>
                                <th>Máquina(linea)</th>
                                <th>Departamento de salida</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="11" class="no-data">No hay dato registrado</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="total-info" id="salida_totalInfo">Total Rows: 0</div>
                </div>
            </div>
        </div>
        <div id="control-retorno-container" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        <div id="recibo-pago-container" style="display: none;">
            <h2>Recibo y pago del material</h2>
            <p>Contenido para Recibo y pago del material - Por implementar</p>
        </div>
        <div id="historial-material-container" style="display: none;">
            <h2>Historial de material</h2>
            <p>Contenido para Historial de material - Por implementar</p>
        </div>
        <div id="estatus-material-container" style="display: none;">
            <h2>Estatus de material</h2>
            <p>Contenido para Estatus de material - Por implementar</p>
        </div>
        <div id="material-sustituto-container" style="display: none;">
            <h2>Material sustituto</h2>
            <p>Contenido para Material sustituto - Por implementar</p>
        </div>
        <div id="consultar-peps-container" style="display: none;">
            <h2>Consultar PEPS</h2>
            <p>Contenido para Consultar PEPS - Por implementar</p>
        </div>
        <div id="longterm-inventory-container" style="display: none;">
            <h2>Control de Long-Term Inventory</h2>
            <p>Contenido para Control de Long-Term Inventory - Por implementar</p>
        </div>
        <div id="registro-material-container" style="display: none;">
            <h2>Registro de material real</h2>
            <p>Contenido para Registro de material real - Por implementar</p>
        </div>
        <div id="historial-inventario-container" style="display: none;">
            <h2>Historial de inventario real</h2>
            <p>Contenido para Historial de inventario real - Por implementar</p>
        </div>
        <div id="ajuste-numero-container" style="display: none;">
            <h2>Ajuste de número de parte</h2>
            <p>Contenido para Ajuste de número de parte - Por implementar</p>
        </div>
    </div>
    
    <!-- Contenedor específico para el contenido de Información Básica (LADO DERECHO) -->
    <div class="informacion-basica-content-area" id="informacion-basica-content-area" style="display: none;">
        <!-- Contenedor por defecto con información general -->
        <div id="info-basica-default-container" style="display: block;">
            <h2>Información Básica</h2>
            <p>Seleccione una opción del menú lateral para ver el contenido correspondiente.</p>
        </div>
        
        <!-- Contenedores para cada opción del sidebar de Información Básica -->
        <div id="admin-usuario-info-container" style="display: none;">
            <h2>Administracion de usuario</h2>
            <p>Contenido para Administracion de usuario - Por implementar</p>
        </div>
        
        <div id="admin-menu-info-container" style="display: none;">
            <h2>Administración de menú</h2>
            <p>Contenido para Administración de menú - Por implementar</p>
        </div>
        
        <div id="admin-autoridad-info-container" style="display: none;">
            <h2>Administración de autoridad</h2>
            <p>Contenido para Administración de autoridad - Por implementar</p>
        </div>
        
        <div id="control-codigo-info-container" style="display: none;">
            <h2>Control de lista de código</h2>
            <p>Contenido para Control de lista de código - Por implementar</p>
        </div>
        
        <div id="admin-itinerario-info-container" style="display: none;">
            <h2>Administración de itinerario</h2>
            <p>Contenido para Administración de itinerario - Por implementar</p>
        </div>
        
        <div id="consultar-licencias-info-container" style="display: none;">
            <h2>Consultar licencias</h2>
            <p>Contenido para Consultar licencias - Por implementar</p>
        </div>
        
        <div id="control-departamento-info-container" style="display: none;">
            <h2>Control de departamento</h2>
            <p>Contenido para Control de departamento - Por implementar</p>
        </div>
        
        <div id="control-proceso-info-container" style="display: none;">
            <h2>Control de proceso</h2>
            <p>Contenido para Control de proceso - Por implementar</p>
        </div>
        
        <div id="control-orden-proceso-info-container" style="display: none;">
            <h2>Control de orden de proceso</h2>
            <p>Contenido para Control de orden de proceso - Por implementar</p>
        </div>
        
        <div id="control-orden-proceso2-info-container" style="display: none;">
            <h2>Control de orden de proceso 2</h2>
            <p>Contenido para Control de orden de proceso 2 - Por implementar</p>
        </div>
        
        <div id="control-defecto-info-container" style="display: none;">
            <h2>Control de defecto por proceso</h2>
            <p>Contenido para Control de defecto por proceso - Por implementar</p>
        </div>
        
        <div id="control-interfaces-info-container" style="display: none;">
            <h2>Control de interfaces de máquina</h2>
            <p>Contenido para Control de interfaces de máquina - Por implementar</p>
        </div>
        
        <div id="control-interlock-info-container" style="display: none;">
            <h2>Control de interlock de máquina en línea</h2>
            <p>Contenido para Control de interlock de máquina en línea - Por implementar</p>
        </div>
        
        <div id="control-material-info-container" style="display: none;">
            <!-- El contenido se cargará dinámicamente con JavaScript -->
        </div>
        
        <div id="configuracion-msl-info-container" style="display: none;">
            <h2>Configuración de MSL</h2>
            <p>Contenido para Configuración de MSL - Por implementar</p>
        </div>
        
        <div id="control-cliente-info-container" style="display: none;">
            <h2>Control de cliente</h2>
            <p>Contenido para Control de cliente - Por implementar</p>
        </div>
        
        <div id="control-proveedor-info-container" style="display: none;">
            <h2>Control de proveedor</h2>
            <p>Contenido para Control de proveedor - Por implementar</p>
        </div>
        
        <div id="control-moneda-info-container" style="display: none;">
            <h2>Control de moneda</h2>
            <p>Contenido para Control de moneda - Por implementar</p>
        </div>
        
        <div id="info-empresa-info-container" style="display: none;">
            <h2>Información de empresa</h2>
            <p>Contenido para Información de empresa - Por implementar</p>
        </div>
        
        <!-- Contenedores adicionales para funciones del sidebar -->
        <div id="control-modelos-info-container" style="display: none;">
            <h2>Control de modelos</h2>
            <p>Contenido para Control de modelos - Por implementar</p>
        </div>
        
        <div id="control-bom-info-container" style="display: none;">
            <h2>Control de BOM</h2>
            <p>Contenido para Control de BOM - Por implementar</p>
        </div>
        
        <div id="control-bom-smt-info-container" style="display: none;">
            <h2>Control de BOM de SMT</h2>
            <p>Contenido para Control de BOM de SMT - Por implementar</p>
        </div>
        
        <div id="control-maquina-inf-info-container" style="display: none;">
            <h2>Control de máquina</h2>
            <p>Contenido para Control de máquina - Por implementar</p>
        </div>
        
        <div id="control-maquina-info-container" style="display: none;">
            <h2>Control de defecto por proceso (máquina)</h2>
            <p>Contenido para Control de defecto por proceso (máquina) - Por implementar</p>
        </div>
        
        <div id="control-maquina-linea-info-container" style="display: none;">
            <h2>Control de máquina en línea</h2>
            <p>Contenido para Control de máquina en línea - Por implementar</p>
        </div>
    </div>
</div>

    <!-- Sistema nuevo desactivado - usando mobile-lists-hamburger.js -->
    <button class="mobile-lists-toggle" id="mobile-lists-toggle" title="Ver listas">
    <i class="bi bi-list-ul"></i>
</button>

<div class="mobile-lists-overlay" id="mobile-lists-overlay"></div>

<div class="mobile-lists-menu" id="mobile-lists-menu">
    <div class="mobile-lists-header">
        <span id="mobile-lists-title">Información Básica</span>
        <button class="mobile-lists-close" id="mobile-lists-close">×</button>
    </div>
    <div class="mobile-lists-content" id="mobile-lists-content">
    </div>
</div>

    <!-- Agrega este overlay justo después del header -->
    <div class="mobile-nav-overlay" id="mobile-nav-overlay"></div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- ANIMACIONES PARA DROPDOWNS EN DESKTOP -->
    <link rel="stylesheet" href="../static/css/desktop-dropdown-animations.css">
    
    <!-- SISTEMA UNIFICADO DE DROPDOWNS - ÚNICO ARCHIVO NECESARIO -->
    <script src="../static/js/unified-dropdowns.js"></script>
    
    <!-- MOBILE LISTS HAMBURGER MENU -->
    <script src="../static/js/mobile-lists-hamburger.js"></script>
    
    <!-- FALLBACK PARA DROPDOWNS - Solo se ejecuta si el sistema unificado falla -->
    <script>
        // Verificar si el sistema unificado se cargó correctamente
        setTimeout(function() {
            if (typeof window.unifiedDropdowns === 'undefined') {
                console.warn('⚠️ Sistema unificado de dropdowns no se cargó, ejecutando fallback...');
                
                // FALLBACK ULTRA-SIMPLE
                document.addEventListener('DOMContentLoaded', function() {
                    
                    function setupSimpleFallback() {
                        
                        const toggleButtons = document.querySelectorAll('[data-bs-toggle="collapse"]');
                        
                        toggleButtons.forEach(function(button) {
                            // Remover listeners existentes
                            const newButton = button.cloneNode(true);
                            button.parentNode.replaceChild(newButton, button);
                            
                            newButton.addEventListener('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                
                                const targetSelector = this.getAttribute('data-bs-target');
                                if (!targetSelector) return;
                                
                                const targetElement = document.querySelector(targetSelector);
                                if (!targetElement) return;
                                
                                const isOpen = targetElement.classList.contains('show');
                                
                                // Cerrar todos los otros primero
                                document.querySelectorAll('.collapse.show').forEach(el => {
                                    if (el !== targetElement) {
                                        el.classList.remove('show');
                                        el.style.display = 'none';
                                    }
                                });
                                
                                // Toggle este elemento
                                if (isOpen) {
                                    targetElement.classList.remove('show');
                                    targetElement.style.display = 'none';
                                    this.setAttribute('aria-expanded', 'false');
                                } else {
                                    targetElement.classList.add('show');
                                    targetElement.style.display = 'block';
                                    this.setAttribute('aria-expanded', 'true');
                                }
                                
                                return false;
                            });
                        });
                        
                    }
                    
                    setupSimpleFallback();
                    
                    // Re-configurar cuando se carga contenido dinámico
                    const originalCargarContenido = window.cargarContenidoDinamico;
                    if (originalCargarContenido) {
                        window.cargarContenidoDinamico = function(containerId, templatePath, initCallback) {
                            return originalCargarContenido(containerId, templatePath, function() {
                                if (initCallback) initCallback();
                                setTimeout(setupSimpleFallback, 100);
                            });
                        };
                    }
                });
            } else {
            }
        }, 1000);
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // ============================================= 
        // PWA SERVICE WORKER REGISTRATION
        // ============================================= 
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('../static/sw.js')
                    .then(function(registration) {
                        
                        // Verificar actualizaciones
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nueva versión disponible
                                    if (confirm('Nueva versión disponible. ¿Desea actualizar?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                        
                    })
                    .catch(function(error) {
                    });
                
                // Manejar mensajes del Service Worker
                navigator.serviceWorker.addEventListener('message', function(event) {
                    const { type, data } = event.data;
                    
                    switch (type) {
                        case 'INSTALL_AVAILABLE':
                            showInstallPrompt();
                            break;
                        case 'APP_INSTALLED':
                            break;
                    }
                });
            });
        }
        
        // ============================================= 
        // PWA INSTALL PROMPT
        // ============================================= 
        let deferredPrompt;
        let installButton;
        
        window.addEventListener('beforeinstallprompt', function(e) {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });
        
        function showInstallButton() {
            // Crear botón de instalación si no existe
            if (!installButton && window.innerWidth <= 768) {
                installButton = document.createElement('button');
                installButton.textContent = '📱 Instalar App';
                installButton.className = 'btn btn-primary install-btn';
                installButton.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    z-index: 1000;
                    border-radius: 25px;
                    padding: 10px 15px;
                    font-size: 14px;
                    background: linear-gradient(45deg, var(--accent-color), #2980b9);
                    border: none;
                    color: white;
                    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
                    animation: pulse 2s infinite;
                `;
                
                // Añadir animación CSS
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes pulse {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.05); }
                        100% { transform: scale(1); }
                    }
                    .install-btn:hover {
                        transform: scale(1.1);
                        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
                    }
                `;
                document.head.appendChild(style);
                
                installButton.addEventListener('click', function() {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then(function(result) {
                            if (result.outcome === 'accepted') {
                            } else {
                            }
                            deferredPrompt = null;
                            hideInstallButton();
                        });
                    }
                });
                
                document.body.appendChild(installButton);
            }
        }
        
        function hideInstallButton() {
            if (installButton) {
                installButton.style.display = 'none';
                setTimeout(() => {
                    if (installButton && installButton.parentNode) {
                        installButton.parentNode.removeChild(installButton);
                    }
                    installButton = null;
                }, 300);
            }
        }
        
        function showInstallPrompt() {
            showInstallButton();
        }
        
        // Ocultar botón de instalación cuando la app ya está instalada
        window.addEventListener('appinstalled', function() {
            hideInstallButton();
            
            // Mostrar mensaje de bienvenida
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    alert('¡App instalada exitosamente! Ahora puedes acceder desde tu pantalla de inicio.');
                }, 1000);
            }
        });
        
        // ============================================= 
        // PWA UTILITIES
        // ============================================= 
        
        // Detectar si la app está ejecutándose como PWA
        function isPWA() {
            return window.matchMedia && window.matchMedia('(display-mode: standalone)').matches;
        }
        
        // Aplicar estilos específicos para PWA
        if (isPWA()) {
            document.body.classList.add('pwa-mode');
            
            // Añadir estilos específicos para PWA
            const pwaStyle = document.createElement('style');
            pwaStyle.textContent = `
                .pwa-mode .app-header {
                    padding-top: env(safe-area-inset-top, 0);
                }
                .pwa-mode .main-content-container {
                    padding-bottom: env(safe-area-inset-bottom, 0);
                }
            `;
            document.head.appendChild(pwaStyle);
        }
        
        // Función para verificar conectividad
        function updateOnlineStatus() {
            const status = navigator.onLine ? 'online' : 'offline';
            document.body.classList.toggle('offline', !navigator.onLine);
            
            if (!navigator.onLine) {
                // Mostrar indicador de offline
                showOfflineIndicator();
            } else {
                hideOfflineIndicator();
            }
        }
        
        function showOfflineIndicator() {
            let indicator = document.getElementById('offline-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'offline-indicator';
                indicator.textContent = '📶 Sin conexión - Modo offline';
                indicator.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background-color: #e74c3c;
                    color: white;
                    text-align: center;
                    padding: 8px;
                    z-index: 2000;
                    font-size: 14px;
                `;
                document.body.appendChild(indicator);
            }
        }
        
        function hideOfflineIndicator() {
            const indicator = document.getElementById('offline-indicator');
            if (indicator) {
                indicator.remove();
            }
        }
        
        // Escuchar cambios de conectividad
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Verificar estado inicial
        updateOnlineStatus();
        

    </script>
    <script>
        // ============================================= 
        // MOBILE NAVIGATION ENHANCED
        // ============================================= 
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.getElementById('menu-toggle');
            const navContainer = document.getElementById('nav-container');
            const overlay = document.getElementById('mobile-nav-overlay');
            const mobileListsToggle = document.getElementById('mobile-lists-toggle');
            const mobileListsMenu = document.getElementById('mobile-lists-menu');
            const mobileListsOverlay = document.getElementById('mobile-lists-overlay');
            const mobileListsClose = document.getElementById('mobile-lists-close');
            const mobileListsContent = document.getElementById('mobile-lists-content');
            const mobileListsTitle = document.getElementById('mobile-lists-title');
            
            // Verificar si estamos en dispositivo móvil
            function isMobile() {
                return window.innerWidth <= 768;
            }
            
            // Función para cerrar menú principal
            function closeMenu() {
                if (navContainer) navContainer.classList.remove('active');
                if (overlay) overlay.classList.remove('active');
                if (menuToggle) menuToggle.classList.remove('active');
                document.body.classList.remove('menu-open');
            }
            
            // Función para mostrar/ocultar el botón flotante
            function toggleMobileListsButton() {
                if (isMobile() && mobileListsToggle) {
                    const materialContainer = document.getElementById('material-container');
                    const hasContentLoaded = materialContainer && materialContainer.style.display !== 'none';
                    
                    if (hasContentLoaded) {
                        mobileListsToggle.style.display = 'flex';
                    } else {
                        mobileListsToggle.style.display = 'none';
                        closeMobileListsMenu(); // Cerrar menú si no hay contenido
                    }
                }
            }
            
            // Función para abrir menú de listas móvil
            function openMobileListsMenu() {
                if (isMobile() && mobileListsMenu && mobileListsOverlay) {
                    // Cargar contenido del sidebar actual
                    loadCurrentSidebarContent();
                    
                    // Mostrar menú y overlay
                    mobileListsMenu.classList.add('active');
                    mobileListsOverlay.classList.add('active');
                    mobileListsToggle.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }
            
            // Función para cerrar menú de listas móvil
            function closeMobileListsMenu() {
                if (mobileListsMenu && mobileListsOverlay) {
                    mobileListsMenu.classList.remove('active');
                    mobileListsOverlay.classList.remove('active');
                    mobileListsToggle.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }
            
            // Función para cargar contenido del sidebar en el menú móvil
            function loadCurrentSidebarContent() {
                // Detectar qué sección está activa para cargar la lista correspondiente
                const activeSection = detectActiveSection();
                loadListContent(activeSection);
            }
            
            // Función para detectar qué sección está activa
            function detectActiveSection() {
                // Lista de contenedores y sus secciones correspondientes
                const sectionContainers = [
                    { id: 'informacion-basica-content-area', section: 'informacion-basica' },
                    { id: 'material-container', section: 'control-material' },
                    { id: 'control-produccion-content-area', section: 'control-produccion' },
                    { id: 'control-proceso-content-area', section: 'control-proceso' },
                    { id: 'control-calidad-content-area', section: 'control-calidad' }
                ];
                
                // Buscar cuál contenedor está visible
                for (const container of sectionContainers) {
                    const element = document.getElementById(container.id);
                    if (element && element.style.display !== 'none') {
                        return container.section;
                    }
                }
                
                // También verificar por URL o contexto actual
                const currentPath = window.location.pathname;
                if (currentPath.includes('informacion') || currentPath.includes('usuario')) {
                    return 'informacion-basica';
                } else if (currentPath.includes('material')) {
                    return 'control-material';
                } else if (currentPath.includes('produccion')) {
                    return 'control-produccion';
                } else if (currentPath.includes('proceso')) {
                    return 'control-proceso';
                } else if (currentPath.includes('calidad')) {
                    return 'control-calidad';
                }
                
                // Por defecto, devolver información básica
                return 'informacion-basica';
            }
            
            // Función para cargar el contenido de las listas
            function loadListContent(section) {
                let listUrl = '';
                let title = '';
                
                // Mapear secciones a archivos de listas
                switch(section) {
                    case 'informacion-basica':
                        listUrl = '/templates/LISTAS/LISTA_INFORMACIONBASICA.html';
                        title = 'Información Básica';
                        break;
                    case 'control-material':
                        listUrl = '/templates/LISTAS/LISTA_DE_MATERIALES.html';
                        title = 'Control de Material';
                        break;
                    case 'control-produccion':
                        listUrl = '/templates/LISTAS/LISTA_CONTROLDEPRODUCCION.html';
                        title = 'Control de Producción';
                        break;
                    case 'control-proceso':
                        listUrl = '/templates/LISTAS/LISTA_CONTROL_DE_PROCESO.html';
                        title = 'Control de Proceso';
                        break;
                    case 'control-calidad':
                        listUrl = '/templates/LISTAS/LISTA_CONTROL_DE_CALIDAD.html';
                        title = 'Control de Calidad';
                        break;
                    default:
                        listUrl = '/templates/LISTAS/LISTA_INFORMACIONBASICA.html';
                        title = 'Información Básica';
                }
                
                // Cargar el archivo de lista
                fetch(`/cargar_template`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ template_path: listUrl.replace('/templates/', '') })
})
.then(response => {
    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }
    console.log('Fetch successful, status:', response.status);
    return response.text();
})
.then(html => {
    console.log('HTML received, length:', html.length);
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html;
    const sidebar = tempDiv.querySelector('.app-sidebar');
    if (sidebar) {
        console.log('Sidebar found, sections:', sidebar.querySelectorAll('.sidebar-section').length);
        convertSidebarToMobileFormat(sidebar);
        mobileListsTitle.textContent = title;
        console.log('Conversion completed, content set');
    } else {
        console.log('No sidebar found in HTML');
        mobileListsContent.innerHTML = `
            <div style="text-align: center; padding: 40px; color: white;">
                <p>No se encontraron listas para esta sección</p>
                <p style="font-size: 12px; color: #ccc;">Sección: ${title}</p>
            </div>
        `;
        mobileListsTitle.textContent = title;
    }
})
.catch(error => {
    console.error('Error cargando lista:', error);
    mobileListsContent.innerHTML = `
        <div style="text-align: center; padding: 40px; color: white;">
            <p>Error cargando la lista</p>
            <p style="font-size: 12px; color: #ccc;">${error.message}</p>
        </div>
    `;
    mobileListsTitle.textContent = title;
});
            }
            
            // Función para convertir el sidebar a formato móvil
            function convertSidebarToMobileFormat(sidebar) {
                const sections = sidebar.querySelectorAll('.sidebar-section');
                let mobileHTML = '';

                sections.forEach((section) => {
                    const dropdownBtn = section.querySelector('.sidebar-dropdown-btn');
                    const dropdownList = section.querySelector('.sidebar-dropdown-list');
                    
                    if (dropdownBtn && dropdownList) {
                        // Extraer el ID del botón para el collapse
                        const targetId = dropdownBtn.getAttribute('data-bs-target');
                        const sectionId = targetId ? targetId.replace('#', '') : 'section_' + Math.random().toString(36).substr(2, 9);
                        
                        const title = dropdownBtn.textContent.trim();
                        const links = dropdownList.querySelectorAll('.sidebar-link');
                        
                        mobileHTML += `
                            <div class="mobile-sidebar-section">
                                <button class="mobile-sidebar-dropdown-btn" data-bs-target="#mobile_${sectionId}">
                                    <span>${title}</span>
                                    <span class="mobile-sidebar-caret"><i class="bi bi-chevron-down"></i></span>
                                </button>
                                <ul class="mobile-sidebar-dropdown-list" id="mobile_${sectionId}">
                        `;
                        
                        links.forEach((link) => {
                            const text = link.textContent.trim();
                            const onclick = link.getAttribute('onclick');
                            
                            mobileHTML += `
                                <li class="mobile-sidebar-link" onclick="${onclick}">
                                    ${text}
                                </li>
                            `;
                        });
                        
                        mobileHTML += `
                                </ul>
                            </div>
                        `;
                    }
                });

                mobileListsContent.innerHTML = mobileHTML;
                setupMobileDropdowns();
                
                // Inicializar el sistema de permisos para el contenido cargado dinámicamente
                // if (typeof PermisosDropdowns !== 'undefined') {
                //     PermisosDropdowns.procesarNuevoContenido(mobileListsContent);
                // } // Comentado para evitar TypeError
            }
            
            // Función para configurar dropdowns móviles
            function setupMobileDropdowns() {
                const mobileDropdownBtns = mobileListsContent.querySelectorAll('.mobile-sidebar-dropdown-btn');
                
                mobileDropdownBtns.forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const targetId = this.getAttribute('data-bs-target');
                        if (targetId) {
                            const targetList = mobileListsContent.querySelector(targetId);
                            if (targetList) {
                                // Toggle activo
                                this.classList.toggle('active');
                                targetList.classList.toggle('active');
                            }
                        }
                    });
                });
                
                // Event listeners para los links móviles
                const mobileLinks = mobileListsContent.querySelectorAll('.mobile-sidebar-link');
                mobileLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        // Cerrar el menú al hacer clic en un enlace
                        closeMobileListsMenu();
                    });
                });
            }
            
            // Event listener para el botón flotante
            if (mobileListsToggle) {
                mobileListsToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (mobileListsMenu.classList.contains('active')) {
                        closeMobileListsMenu();
                    } else {
                        openMobileListsMenu();
                    }
                });
            }
            
            // Event listener para el botón de cerrar del menú móvil
            if (mobileListsClose) {
                mobileListsClose.addEventListener('click', function() {
                    closeMobileListsMenu();
                });
            }
            
            // Event listener para cerrar menú tocando el overlay
            if (mobileListsOverlay) {
                mobileListsOverlay.addEventListener('click', function() {
                    closeMobileListsMenu();
                });
            }
            
            
            // Mostrar/ocultar botón flotante cuando se carga contenido
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        toggleMobileListsButton();
                    }
                });
            });
            
            const materialContainer = document.getElementById('material-container');
            if (materialContainer) {
                observer.observe(materialContainer, { attributes: true });
            }
            
            // Observar cambios en las áreas de contenido para detectar cuando se cargan nuevas secciones
            const contentObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        // Verificar si algún contenido se hizo visible
                        if (mutation.target.style.display !== 'none') {
                            // Pequeño delay para asegurar que el contenido esté completamente cargado
                            setTimeout(() => {
                                loadCurrentSidebarContent();
                            }, 100);
                        }
                    }
                });
            });
            
            // Observar las áreas de contenido principales
            const contentAreas = [
                'informacion-basica-content-area',
                'material-container',
                'control-produccion-content-area',
                'control-proceso-content-area',
                'control-calidad-content-area'
            ];
            
            contentAreas.forEach(areaId => {
                const area = document.getElementById(areaId);
                if (area) {
                    contentObserver.observe(area, { attributes: true });
                }
            });
            
            // Verificar al cargar la página
            toggleMobileListsButton();
            
            // Función para abrir menú
            function openMenu() {
                if (navContainer) navContainer.classList.add('active');
                if (overlay) overlay.classList.add('active');
                if (menuToggle) menuToggle.classList.add('active');
                document.body.classList.add('menu-open');
            }
            
            // Toggle del menú hamburguesa
            if (menuToggle && navContainer && overlay) {
                menuToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (navContainer.classList.contains('active')) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                });
                
                // Cerrar menú al hacer click en overlay
                overlay.addEventListener('click', function() {
                    closeMenu();
                });
                
                // Cerrar menú al hacer click en un botón de navegación (solo en móvil)
                const navButtons = navContainer.querySelectorAll('.nav-button');
                navButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const buttonText = this.textContent.trim();
                        
                        if (isMobile()) {
                            // Mapeo de botones a funciones de carga de contenido
                            const buttonActions = {
                                'Información Básica': () => {
                                    window.mostrarInformacionBasica();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('informacion-basica-content', '/listas/informacion_basica');
                                    }, 100);
                                },
                                'Control de material': () => {
                                    window.mostrarControlMaterial();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-material-content', '/listas/control_material');
                                    }, 100);
                                },
                                'Control de producción': () => {
                                    window.mostrarControlProduccion();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-produccion-content', '/listas/control_produccion');
                                    }, 100);
                                },
                                'Control de proceso': () => {
                                    window.mostrarControlProceso();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-proceso-content', '/listas/control_proceso');
                                    }, 100);
                                },
                                'Control de calidad': () => {
                                    window.mostrarControlCalidad();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-calidad-content', '/listas/control_calidad');
                                    }, 100);
                                },
                                'Control de resultados': () => {
                                    window.mostrarControlResultados();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-resultados-content', '/listas/control_resultados');
                                    }, 100);
                                },
                                'Control de reporte': () => {
                                    window.mostrarControlReporte();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-reporte-content', '/listas/control_reporte');
                                    }, 100);
                                },
                                'Configuración de programa': () => {
                                    window.mostrarConfiguracionPrograma();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('configuracion-programa-content', '/listas/configuracion_programa');
                                    }, 100);
                                }
                            };
                            
                            // Ejecutar la acción correspondiente
                            if (buttonActions[buttonText]) {
                                buttonActions[buttonText]();
                            } else {
                                console.warn(`⚠️ No se encontró acción para: ${buttonText}`);
                            }
                            
                            setTimeout(closeMenu, 300); // Pequeño delay para mejor UX
                        }
                    });
                });
                
                // Cerrar menú con tecla Escape
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && navContainer.classList.contains('active')) {
                        closeMenu();
                    }
                });
                
                // Cerrar menú al cambiar orientación
                window.addEventListener('orientationchange', function() {
                    setTimeout(closeMenu, 100);
                    if (isMobile()) {
                        closeMobileSidebar(); // Cerrar sidebar al cambiar orientación
                    }
                });
                
                // Cerrar menú al redimensionar ventana
                window.addEventListener('resize', function() {
                    if (!isMobile()) {
                        closeMenu();
                        closeMobileSidebar(); // Cerrar sidebar en desktop
                        toggleMobileListsButton(); // Ocultar botón flotante en desktop
                    } else {
                        toggleMobileListsButton(); // Mostrar/ocultar botón según contenido
                    }
                });
                
                // Cerrar sidebar móvil con tecla Escape
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && isMobile()) {
                        closeMobileSidebar();
                    }
                });
            }
            
            // ============================================= 
            // TOUCH GESTURES PARA MÓVIL
            // ============================================= 
            let touchStartX = 0;
            let touchStartY = 0;
            let touchEndX = 0;
            let touchEndY = 0;
            
            // Detectar swipe gestures
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
                touchStartY = e.changedTouches[0].screenY;
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                touchEndY = e.changedTouches[0].screenY;
                handleSwipeGesture();
            }, { passive: true });
            
            function handleSwipeGesture() {
                const swipeThreshold = 50;
                const swipeDistance = touchEndX - touchStartX;
                const verticalDistance = Math.abs(touchEndY - touchStartY);
                
                // Solo procesar swipe horizontal si el vertical es mínimo
                if (verticalDistance < 100 && Math.abs(swipeDistance) > swipeThreshold) {
                    if (swipeDistance > 0 && touchStartX < 50) {
                        // Swipe derecha desde el borde izquierdo - abrir menú
                        if (isMobile() && !navContainer.classList.contains('active')) {
                            openMenu();
                        }
                    } else if (swipeDistance < 0 && navContainer.classList.contains('active')) {
                        // Swipe izquierda - cerrar menú
                        closeMenu();
                    }
                }
            }
            
            // ============================================= 
            // OPTIMIZACIONES DE RENDIMIENTO MÓVIL
            // ============================================= 
            
            // Throttle para eventos de scroll
            function throttle(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            // Optimizar scroll en móviles
            if (isMobile()) {
                const scrollableElements = document.querySelectorAll('.sidebar-content, .material-content-area, .informacion-basica-content-area');
                scrollableElements.forEach(element => {
                    element.style.webkitOverflowScrolling = 'touch';
                    element.style.overflowScrolling = 'touch';
                    element.classList.add('scrollable');
                });
            }
            
            // Prevenir zoom en inputs (iOS)
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                const inputs = document.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.style.fontSize < '16px') {
                        input.style.fontSize = '16px';
                    }
                });
            }
            
            // ============================================= 
            // VIEWPORT HEIGHT FIX PARA MÓVILES
            // ============================================= 
            function setViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', vh + 'px');
            }
            
            setViewportHeight();
            window.addEventListener('resize', throttle(setViewportHeight, 250));
            window.addEventListener('orientationchange', function() {
                setTimeout(setViewportHeight, 500);
            });
            

        });    
    </script>

    <script>    
        // Mostrar/ocultar el contenedor de material según el botón
        document.addEventListener('DOMContentLoaded', function() {
            
            // ===============================================
            // DEFINIR TODAS LAS FUNCIONES AL INICIO
            // ===============================================
            
            // Control de debugging - Cambia a true si necesitas mensajes de consola para debugging
            const DEBUG_MODE = false;
            
            // Función de logging condicional
            function debugLog(...args) {
                if (DEBUG_MODE) {
                }
            }
            
            // NUEVA FUNCIÓN: Cerrar todos los dropdowns en un contenedor
            function cerrarTodosLosDropdowns(container = document) {
                // Buscar todos los elementos con class "show" y "collapse"
                const elementosAbiertos = container.querySelectorAll('.collapse.show');
                elementosAbiertos.forEach(elemento => {
                    elemento.classList.remove('show');
                });
                
                // Buscar todos los botones con aria-expanded="true"
                const botonesExpandidos = container.querySelectorAll('[aria-expanded="true"]');
                botonesExpandidos.forEach(boton => {
                    boton.setAttribute('aria-expanded', 'false');
                });
            }
            
            // Hacer la función disponible globalmente para debugging
            window.cerrarTodosLosDropdowns = cerrarTodosLosDropdowns;
            
            // Función para limpiar event listeners duplicados de Bootstrap
            function limpiarEventListenersBootstrap() {
                
                try {
                    // Usar el sistema unificado si está disponible
                    if (window.unifiedDropdowns) {
                        window.unifiedDropdowns.cleanup();
                        window.unifiedDropdowns.init();
                        return;
                    }
                    
                    console.warn('⚠️ Sistema unificado no disponible, usando limpieza manual');
                    // Fallback manual (código anterior)
                    const dropdownButtons = document.querySelectorAll('[data-bs-toggle="collapse"]');
                    dropdownButtons.forEach(button => {
                        const newButton = button.cloneNode(true);
                        button.parentNode.replaceChild(newButton, button);
                    });
                    
                } catch (error) {
                    console.error('❌ Error en limpieza de event listeners:', error);
                }
            }
            
            // Función mejorada para cerrar dropdowns
            function cerrarTodosLosDropdownsMejorada(container = null) {
                
                try {
                    // Usar el sistema unificado si está disponible
                    if (window.unifiedDropdowns) {
                        window.unifiedDropdowns.closeAll();
                        return;
                    }
                    
                    console.warn('⚠️ Sistema unificado no disponible, usando método manual');
                    // Fallback manual
                    document.querySelectorAll('.collapse.show').forEach(elemento => {
                        elemento.classList.remove('show');
                        elemento.style.display = 'none';
                    });
                    
                    document.querySelectorAll('[aria-expanded="true"]').forEach(boton => {
                        boton.setAttribute('aria-expanded', 'false');
                    });
                    
                } catch (error) {
                    console.error('❌ Error cerrando dropdowns:', error);
                }
            }
            
            // Función genérica para cargar contenido dinámicamente
            window.cargarContenidoDinamico = function(containerId, templatePath, initCallback = null) {
                const container = document.getElementById(containerId);
                if (!container) {
                    console.error(`✗ Container ${containerId} no encontrado`);
                    return Promise.reject(`Container ${containerId} no encontrado`);
                }
                
                
                // 1. CERRAR TODOS LOS DROPDOWNS ANTES DE LIMPIAR
                cerrarTodosLosDropdownsMejorada();
                
                // 1.1. LIMPIAR TODAS LAS SELECCIONES ACTIVAS
                if (window.unifiedDropdowns && window.unifiedDropdowns.clearAllSelections) {
                    window.unifiedDropdowns.clearAllSelections();
                }
                
                // 2. LIMPIAR EL CONTENEDOR
                container.innerHTML = '<div class="loading-indicator">Cargando...</div>';
                
                // 3. CARGAR EL CONTENIDO DINÁMICAMENTE
                return fetch(templatePath)
                    .then(response => {
                        if (!response.ok) {
                            // Manejar específicamente errores de permisos
                            if (response.status === 403) {
                                return response.text().then(errorHtml => {
                                    container.innerHTML = errorHtml;
                                    throw new Error('Permisos insuficientes');
                                });
                            } else if (response.status === 401) {
                                // Usuario no autenticado
                                container.innerHTML = `
                                    <div style="
                                        display: flex; 
                                        flex-direction: column; 
                                        align-items: center; 
                                        justify-content: center; 
                                        height: 400px; 
                                        background: #2c2c2c; 
                                        color: #e0e0e0; 
                                        border-radius: 10px; 
                                        margin: 20px;
                                        text-align: center;
                                    ">
                                        <i class="fas fa-user-lock" style="font-size: 3rem; color: #ffc107; margin-bottom: 20px;"></i>
                                        <h3>Sesión Expirada</h3>
                                        <p>Tu sesión ha expirado. Por favor, inicia sesión nuevamente.</p>
                                        <button onclick="window.location.href='/login'" class="btn btn-primary mt-3">Iniciar Sesión</button>
                                    </div>
                                `;
                                throw new Error('Usuario no autenticado');
                            } else {
                                throw new Error('Error al cargar el contenido: ' + response.status);
                            }
                        }
                        return response.text();
                    })
                    .then(html => {
                        container.innerHTML = html;
                        
                        // 4. ESPERAR UN POCO ANTES DE INICIALIZAR COMPONENTES
                        setTimeout(() => {
                            // Re-inicializar tooltips si existen en el nuevo contenido
                            const tooltipTriggerList = container.querySelectorAll('[data-bs-toggle="tooltip"]');
                            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                                new bootstrap.Tooltip(tooltipTriggerEl);
                            });
                            
                            // 5. REINICIALIZAR EL SISTEMA UNIFICADO DE DROPDOWNS
                            if (window.unifiedDropdowns) {
                                window.unifiedDropdowns.init();
                            }
                            
                            
                            // Ejecutar callback de inicialización si se proporciona
                            if (initCallback && typeof initCallback === 'function') {
                                initCallback();
                            }
                        }, 150);
                        
                        // Ejecutar cualquier script que pueda estar en el HTML cargado
                        const scripts = container.querySelectorAll('script');
                        scripts.forEach(script => {
                            const newScript = document.createElement('script');
                            if (script.src) {
                                newScript.src = script.src;
                            } else {
                                newScript.textContent = script.textContent;
                            }
                            document.head.appendChild(newScript);
                        });
                        
                        return html;
                    })
                    .catch(error => {
                        console.error('❌ Error al cargar el contenido:', error);
                        // Solo mostrar mensaje genérico si no es un error de permisos
                        if (!error.message.includes('Permisos insuficientes') && !error.message.includes('Usuario no autenticado')) {
                            container.innerHTML = '<div class="error-message">Error al cargar el contenido. Por favor, intente nuevamente.</div>';
                        }
                        throw error;
                    });
            };
            
            // ===============================================
            // AHORA INICIALIZAR VARIABLES Y ELEMENTOS
            // ===============================================
            
            const materialContainer = document.getElementById('material-container');
            const informacionBasicaContent = document.getElementById('informacion-basica-content');
            const controlMaterialContent = document.getElementById('control-material-content');
            const controlProduccionContent = document.getElementById('control-produccion-content');
            const controlProcesoContent = document.getElementById('control-proceso-content');
            const controlCalidadContent = document.getElementById('control-calidad-content');
            const controlResultadosContent = document.getElementById('control-resultados-content');
            const controlReporteContent = document.getElementById('control-reporte-content');
            const configuracionProgramaContent = document.getElementById('configuracion-programa-content');
            const materialContentArea = document.getElementById('material-content-area');
            const informacionBasicaContentArea = document.getElementById('informacion-basica-content-area');
            const materialInfoContainer = document.getElementById('material-info-container');
            const controlAlmacenContainer = document.getElementById('control-almacen-container');
            const controlSalidaContainer = document.getElementById('control-salida-container');
            const controlRetornoContainer = document.getElementById('control-retorno-container');
            const reciboPagoContainer = document.getElementById('recibo-pago-container');
            const historialMaterialContainer = document.getElementById('historial-material-container');
            const estatusMaterialContainer = document.getElementById('estatus-material-container');
            const materialSustitutoContainer = document.getElementById('material-sustituto-container');
            const consultarPepsContainer = document.getElementById('consultar-peps-container');
            const longtermInventoryContainer = document.getElementById('longterm-inventory-container');
            const registroMaterialContainer = document.getElementById('registro-material-container');
            const historialInventarioContainer = document.getElementById('historial-inventario-container');
            const ajusteNumeroContainer = document.getElementById('ajuste-numero-container');
            const navButtons = document.querySelectorAll('.nav-button');
            
            // Función para ocultar todo el contenido
            function hideAllContent() {
                // Ocultar todos los contenedores principales
                informacionBasicaContent.style.display = 'none';
                controlMaterialContent.style.display = 'none';
                controlProduccionContent.style.display = 'none';
                controlProcesoContent.style.display = 'none';
                controlCalidadContent.style.display = 'none';
                controlResultadosContent.style.display = 'none';
                if (controlReporteContent) controlReporteContent.style.display = 'none';
                configuracionProgramaContent.style.display = 'none';
                
                // FORZAR ocultar completamente las áreas de contenido
                materialContentArea.style.display = 'none';
                informacionBasicaContentArea.style.display = 'none';
                
                // Limpiar contenido de los contenedores principales para evitar superposición
                const containersToClean = [
                    'informacion-basica-content',
                    'control-material-content', 
                    'control-produccion-content',
                    'control-proceso-content',
                    'control-calidad-content',
                    'control-resultados-content',
                    'control-reporte-content',
                    'configuracion-programa-content'
                ];
                
                containersToClean.forEach(containerId => {
                    const container = document.getElementById(containerId);
                    if (container && container.innerHTML.trim() !== '') {
                        // Solo limpiar si tiene contenido, mantener un placeholder
                        container.innerHTML = '<!-- El contenido se cargará dinámicamente con JavaScript -->';
                    }
                });
                
                hideAllMaterialContainers();
                hideAllInformacionBasicaContainers();
            }
            
            // Función para resetear completamente la pestaña de Información Básica
            function resetInformacionBasica() {
                // Llamar a la función global de reseteo si existe
                if (typeof window.resetInfoBasicaToDefault === 'function') {
                    window.resetInfoBasicaToDefault();
                }
                
                // Asegurar que todos los sidebar-links funcionen
                const sidebarLinks = informacionBasicaContent.querySelectorAll('.sidebar-link');
                sidebarLinks.forEach(link => {
                    link.style.pointerEvents = 'auto';
                    link.style.cursor = 'pointer';
                });
            }
            
            // Función para ocultar todos los contenedores de material
            function hideAllMaterialContainers() {
                materialInfoContainer.style.display = 'none';
                controlAlmacenContainer.style.display = 'none';
                controlSalidaContainer.style.display = 'none';
                controlRetornoContainer.style.display = 'none';
                reciboPagoContainer.style.display = 'none';
                historialMaterialContainer.style.display = 'none';
                estatusMaterialContainer.style.display = 'none';
                materialSustitutoContainer.style.display = 'none';
                consultarPepsContainer.style.display = 'none';
                longtermInventoryContainer.style.display = 'none';
                registroMaterialContainer.style.display = 'none';
                historialInventarioContainer.style.display = 'none';
                ajusteNumeroContainer.style.display = 'none';
            }
            
            function hideAllInformacionBasicaContainers() {
                const containers = [
                    'info-basica-default-container',
                    'admin-usuario-info-container', 
                    'admin-menu-info-container',
                    'admin-autoridad-info-container',
                    'control-codigo-info-container',
                    'admin-itinerario-info-container',
                    'consultar-licencias-info-container',
                    'control-departamento-info-container',
                    'control-proceso-info-container',
                    'control-orden-proceso-info-container',
                    'control-orden-proceso2-info-container',
                    'control-defecto-info-container',
                    'control-interfaces-info-container',
                    'control-interlock-info-container',
                    'control-material-info-container',
                    'configuracion-msl-info-container',
                    'control-cliente-info-container',
                    'control-proveedor-info-container',
                    'control-moneda-info-container',
                    'info-empresa-info-container',
                    // Contenedores adicionales para sidebar
                    'control-modelos-info-container',
                    'control-bom-info-container',
                    'control-bom-smt-info-container',
                    'control-maquina-inf-info-container',
                    'control-maquina-info-container',
                    'control-maquina-linea-info-container'
                ];
                
                containers.forEach(containerId => {
                    const container = document.getElementById(containerId);
                    if (container) {
                        container.style.display = 'none';
                    }
                });
            }
            
            // Hacer la función disponible globalmente
            window.hideAllInformacionBasicaContainers = hideAllInformacionBasicaContainers;
            
            // Funciones globales para mostrar cada contenedor de Información Básica
            window.mostrarAdminUsuarioInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('admin-usuario-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarAdminMenuInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('admin-menu-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarAdminAutoridadInfo = function() {

                hideAllInformacionBasicaContainers();
                const container = document.getElementById('admin-autoridad-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlCodigoInfo = function() {

                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-codigo-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarAdminItinerarioInfo = function() {

                hideAllInformacionBasicaContainers();
                const container = document.getElementById('admin-itinerario-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarConsultarLicenciasInfo = function() {

                hideAllInformacionBasicaContainers();
                const container = document.getElementById('consultar-licencias-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlDepartamentoInfo = function() {

                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-departamento-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlProcesoInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-proceso-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlOrdenProcesoInfo = function() {

                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-orden-proceso-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlOrdenProceso2Info = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-orden-proceso2-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlDefectoInfo = function() {

                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-defecto-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlInterfacesInfo = function() {

                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-interfaces-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlInterlockInfo = function() {

                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-interlock-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarConfiguracionMSLInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('configuracion-msl-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlClienteInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-cliente-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlProveedorInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-proveedor-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            // NUEVA FUNCIÓN: Control de material para Información Básica
            window.mostrarControlMaterialInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-material-info-container');
                if (container) {
                    container.style.display = 'block';
                    
                    // Cargar el contenido dinámicamente del endpoint específico
                    cargarContenidoDinamico('control-material-info-container', '/informacion_basica/control_de_material')
                        .then(() => {
                        })
                        .catch(error => {
                            console.error('❌ Error cargando Control de Material de Información Básica:', error);
                            container.innerHTML = '<div class="error-message"><h3>Error al cargar el contenido</h3><p>No se pudo cargar Control de Material. Por favor, intente nuevamente.</p></div>';
                        });
                }
            };
            
            // Funciones adicionales para el sidebar de Información Básica
            window.mostrarControlModelosInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-modelos-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlBOMInfo = function() {
                // Verificar permisos antes de continuar
                if (typeof PermisosDropdowns !== 'undefined' && 
                    !PermisosDropdowns.tienePermiso('LISTA_INFORMACIONBASICA', 'Información básica', 'Control de BOM')) {
                    alert('⚠️ No tienes permisos para acceder a: Control de BOM');
                    return false;
                }
                
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-bom-info-container');
                if (container) {
                    container.style.display = 'block';
                    
                    // Cargar el contenido dinámicamente del endpoint específico
                    cargarContenidoDinamico('control-bom-info-container', '/informacion_basica/control_de_bom')
                        .then(() => {
                        })
                        .catch(error => {
                            console.error('❌ Error cargando Control de BOM de Información Básica:', error);
                            // El error ya se muestra en cargarContenidoDinamico, no hacer nada más aquí
                        });
                }
            };
            
            window.mostrarControlBOMSMTInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-bom-smt-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.Controlmaquinainf = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-maquina-inf-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlMaquinaInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-maquina-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlMaquinaLineaInfo = function() {
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-maquina-linea-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            // Función para mostrar el contenido por defecto de material
            window.mostrarInfoMaterial = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                materialInfoContainer.style.display = 'block';
                
                // Cargar contenido dinámicamente
                cargarContenidoDinamico('material-info-container', '/material/info')
                    .catch(error => console.error('Error cargando info material:', error));
            };
            
            // Función global para mostrar el contenido de almacén
            window.mostrarControlAlmacen = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                controlAlmacenContainer.style.display = 'block';
                
                // Cargar contenido dinámicamente con callback de inicialización
                cargarContenidoDinamico('control-almacen-container', '/material/control_almacen', () => {

                    
                    // Intentar inicializar funciones de control de almacén (sin mensajes de advertencia)
                    if (typeof window.inicializarControlAlmacenModule === 'function') {
                        window.inicializarControlAlmacenModule();
                    } else if (typeof window.inicializarControlAlmacen === 'function') {
                        window.inicializarControlAlmacen();
                    } else {
                        // Intentar métodos individuales sin mensajes de error
                        if (typeof cargarCodigosMaterial === 'function') cargarCodigosMaterial();
                        if (typeof cargarClienteSeleccionado === 'function') cargarClienteSeleccionado();
                        if (typeof cargarSiguienteSecuencial === 'function') cargarSiguienteSecuencial();
                    }
                })
                .catch(error => {
                    console.error('Error cargando control de almacén:', error);
                });
                

            };
            
            // Funciones para mostrar otros contenidos
            window.mostrarControlSalida = function() {

                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                controlSalidaContainer.style.display = 'block';
                
                // Inicializar directamente sin carga dinámica (contenido ya embebido)
                setTimeout(() => {
                    if (typeof window.inicializarControlSalidaModule === 'function') {
                        window.inicializarControlSalidaModule();
                    } else if (typeof inicializarControlSalida === 'function') {
                        inicializarControlSalida();
                    } else {
                        console.warn('⚠️ Funciones de inicialización de Control de Salida no disponibles');
                    }
                }, 200);
                

            };
            
            window.mostrarControlRetorno = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                controlRetornoContainer.style.display = 'block';
                
                // Cargar contenido dinámicamente con callback de inicialización
                cargarContenidoDinamico('control-retorno-container', '/material/control_retorno', () => {
                    
                    // Intentar inicializar funciones de control de retorno
                    if (typeof window.initControlRetorno === 'function') {
                        window.initControlRetorno();
                    } else if (typeof initControlRetorno === 'function') {
                        initControlRetorno();
                    }
                })
                .catch(error => {
                    console.error('Error cargando control de retorno:', error);
                });
                
            };
            
            window.mostrarReciboPago = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                reciboPagoContainer.style.display = 'block';
            };
            
            window.mostrarHistorialMaterial = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                historialMaterialContainer.style.display = 'block';
            };
            
            window.mostrarEstatusMaterial = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                estatusMaterialContainer.style.display = 'block';
                
                // Cargar contenido dinámicamente usando la ruta del servidor
                cargarContenidoDinamico('estatus-material-container', '/material/estatus_material', () => {
                    
                    // Inicializar funcionalidades específicas del estatus de material si es necesario
                    if (typeof window.initEstatusMaterial === 'function') {
                        window.initEstatusMaterial();
                    }
                });
            };
            
            window.mostrarMaterialSustituto = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                materialSustitutoContainer.style.display = 'block';
            };
            
            window.mostrarConsultarPeps = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                consultarPepsContainer.style.display = 'block';
            };
            
            window.mostrarLongtermInventory = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                longtermInventoryContainer.style.display = 'block';
            };
            
            window.mostrarRegistroMaterial = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                registroMaterialContainer.style.display = 'block';
                
                // Cargar el contenido dinámicamente
                cargarContenidoDinamico('registro-material-container', '/material/registro_material', () => {
                    
                    // Inicializar funcionalidades específicas del registro de material si es necesario
                    if (typeof initRegistroMaterial === 'function') {
                        initRegistroMaterial();
                    }
                });
            };
            
            window.mostrarHistorialInventario = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                historialInventarioContainer.style.display = 'block';
                
                // Cargar el contenido dinámicamente
                cargarContenidoDinamico('historial-inventario-container', '/material/historial_inventario', () => {
                    
                    // Inicializar funcionalidades específicas del historial de inventario si es necesario
                    if (typeof initHistorialInventario === 'function') {
                        initHistorialInventario();
                    }
                });
            };
            
            window.mostrarAjusteNumero = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                ajusteNumeroContainer.style.display = 'block';
            };
            
            // Función global para ocultar el contenido de almacén
            window.ocultarControlAlmacen = function() {
                materialContentArea.style.display = 'none';
                hideAllMaterialContainers();
            };
            
            navButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remover la clase 'active' de todos los botones
                    navButtons.forEach(b => b.classList.remove('active'));
                    // Agregar la clase 'active' al botón clickeado
                    this.classList.add('active');
                    
                    // Ocultar todo el contenido primero
                    hideAllContent();
                    
                    if (this.id === 'Información Basica') {
                        materialContainer.style.display = 'block';
                        informacionBasicaContent.style.display = 'block';
                        informacionBasicaContentArea.style.display = 'block';
                        
                        // Cargar contenido dinámicamente y mostrar contenedor por defecto
                        cargarContenidoDinamico('informacion-basica-content', '/listas/informacion_basica')
                            .then(() => {
                                // Asegurar que el área de contenido esté visible
                                informacionBasicaContentArea.style.display = 'block';
                                hideAllInformacionBasicaContainers();
                                const defaultContainer = document.getElementById('info-basica-default-container');
                                if (defaultContainer) {
                                    defaultContainer.style.display = 'block';
                                }
                            })
                            .catch(error => {
                                console.error('Error cargando Información Básica:', error);
                                // Fallback: mostrar contenedor por defecto aunque falle la carga
                                informacionBasicaContentArea.style.display = 'block';
                                hideAllInformacionBasicaContainers();
                                const defaultContainer = document.getElementById('info-basica-default-container');
                                if (defaultContainer) {
                                    defaultContainer.style.display = 'block';
                                }
                            });
                        
                    } else if (this.id === 'Control de material') {
                        materialContainer.style.display = 'block';
                        controlMaterialContent.style.display = 'block';
                        
                        // Cargar contenido dinámicamente del sidebar de materiales
                        cargarContenidoDinamico('control-material-content', '/listas/control_material')
                            .then(() => {
                                // No mostrar material-content-area, solo el sidebar
                                materialContentArea.style.display = 'none';
                                hideAllMaterialContainers();
                                // IMPORTANTE: Ocultar también los contenedores de información básica
                                hideAllInformacionBasicaContainers();
                                informacionBasicaContentArea.style.display = 'none';
                            })
                            .catch(error => {
                                console.error('Error cargando Control de Material:', error);
                                // Fallback: ocultar el área de material y información básica
                                materialContentArea.style.display = 'none';
                                hideAllMaterialContainers();
                                hideAllInformacionBasicaContainers();
                                informacionBasicaContentArea.style.display = 'none';
                            });
                        
                    } else if (this.id === 'Control de producción') {
                        materialContainer.style.display = 'block';
                        controlProduccionContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido dinámicamente
                        cargarContenidoDinamico('control-produccion-content', '/listas/control_produccion')
                            .catch(error => console.error('Error cargando Control de Producción:', error));
                        
                    } else if (this.id === 'Control de proceso') {
                        materialContainer.style.display = 'block';
                        controlProcesoContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido dinámicamente
                        cargarContenidoDinamico('control-proceso-content', '/listas/control_proceso')
                            .catch(error => console.error('Error cargando Control de Proceso:', error));
                        
                    } else if (this.id === 'Control de calidad') {
                        materialContainer.style.display = 'block';
                        controlCalidadContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido dinámicamente
                        cargarContenidoDinamico('control-calidad-content', '/listas/control_calidad')
                            .catch(error => console.error('Error cargando Control de Calidad:', error));
                        
                    } else if (this.id === 'Control de resultados') {
                        materialContainer.style.display = 'block';
                        controlResultadosContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido dinámicamente
                        cargarContenidoDinamico('control-resultados-content', '/listas/control_resultados')
                            .catch(error => console.error('Error cargando Control de Resultados:', error));
                        
                    } else if (this.id === 'Control de reporte') {
                        materialContainer.style.display = 'block';
                        if (controlReporteContent) controlReporteContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido dinámicamente
                        cargarContenidoDinamico('control-reporte-content', '/listas/control_reporte')
                            .catch(error => console.error('Error cargando Control de Reporte:', error));
                        
                    } else if (this.id === 'Configuración de programa') {
                        materialContainer.style.display = 'block';
                        configuracionProgramaContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido dinámicamente
                        cargarContenidoDinamico('configuracion-programa-content', '/listas/configuracion_programa')
                            .catch(error => console.error('Error cargando Configuración de Programa:', error));
                        
                    } else {
                        materialContainer.style.display = 'none';
                        // FORZAR ocultar el área de material para cualquier otro caso
                        materialContentArea.style.display = 'none';
                    }
                });
            });
            
            // Por defecto oculto
            materialContainer.style.display = 'none';
            
            // FORZAR estado inicial correcto
            materialContentArea.style.display = 'none';
            hideAllMaterialContainers();
            
            // Activar por defecto la primera pestaña (Información Básica) si no hay ninguna activa
            const activeButton = document.querySelector('.nav-button.active');
            if (!activeButton) {
                const infoBasicaButton = document.getElementById('Información Basica');
                if (infoBasicaButton) {
                    infoBasicaButton.classList.add('active');
                }
            }
        });
        
        // Función para confirmar logout
        function confirmarLogout() {
            if (confirm('¿Está seguro que desea cerrar la sesión?')) {
                // Mostrar mensaje de cierre
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                    color: white;
                    font-size: 1.2rem;
                    text-align: center;
                `;
                overlay.innerHTML = `
                    <div>
                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                        <div>Cerrando sesión...</div>
                    </div>
                `;
                document.body.appendChild(overlay);
                
                // Redirigir después de un breve delay
                setTimeout(() => {
                    window.location.href = '/logout';
                }, 1000);
            }
        }
        
        // Inicializar el sistema de permisos cuando la página esté completamente cargada
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof PermisosDropdowns !== 'undefined') {
                PermisosDropdowns.init();
            }
        });
        
        // ===============================================
        // CONTROL DE SALIDA - FUNCIONES EMBEBIDAS
        // ===============================================
        
        // Variables globales para Control de Salida
        let materialActual = null;
        let verificacionCompletada = false;

        // Función global para inicializar cuando se muestra el control de salida
        window.inicializarControlSalidaModule = function() {
            setTimeout(() => {
                inicializarControlSalida();
            }, 100);
        };

        // Función de inicialización simplificada
        function inicializarControlSalida() {
            // Establecer fecha actual
            const hoy = new Date().toISOString().split('T')[0];
            const fechaSalidaForm = document.getElementById('salida_fecha_salida_form');
            
            if (fechaSalidaForm) fechaSalidaForm.value = hoy;

            // Establecer fecha actual en los filtros de historial
            const fechaDesde = document.getElementById('salida_fecha_desde');
            const fechaHasta = document.getElementById('salida_fecha_hasta');
            
            if (fechaDesde) fechaDesde.value = hoy;
            if (fechaHasta) fechaHasta.value = hoy;

            // Configurar listeners para el checkbox de registro automático
            configurarRegistroAutomatico();

            // Cargar modelos disponibles en el BOM
            if (typeof cargarModelosBOM === 'function') {
                cargarModelosBOM();
            }

            // Enfocar campo de código
            const codigoInput = document.getElementById('salida_codigo_material_recibido');
            if (codigoInput) {
                setTimeout(() => codigoInput.focus(), 100);
            }

            // Mostrar por defecto las tablas de registro
            if (typeof mostrarRegistroSalida === 'function') {
                mostrarRegistroSalida();
            }
        }

        // Nueva función para configurar el comportamiento del registro automático
        function configurarRegistroAutomatico() {
            const checkbox = document.getElementById('salida_registroAutomatico');
            const btnGuardar = document.getElementById('salida_btnGuardarSalida');
            
            if (checkbox && btnGuardar) {
                // Configurar estado inicial
                actualizarModoRegistro();
                
                // Listener para cambios en el checkbox
                checkbox.addEventListener('change', function() {
                    actualizarModoRegistro();
                });
            }
        }

        // Función para actualizar el modo de registro según el checkbox
        function actualizarModoRegistro() {
            const checkbox = document.getElementById('salida_registroAutomatico');
            const btnGuardar = document.getElementById('salida_btnGuardarSalida');
            
            if (checkbox && btnGuardar) {
                if (checkbox.checked) {
                    btnGuardar.style.display = 'none';
                } else {
                    btnGuardar.style.display = 'block';
                }
            }
        }

        // FUNCIÓN PRINCIPAL: Procesar escaneo ultra rápido
        async function procesarEscaneoRapido(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                
                const codigo = event.target.value.trim();
                
                if (!codigo) {
                    return;
                }
                
                try {
                    const response = await fetch(`/buscar_material_por_codigo?codigo_recibido=${encodeURIComponent(codigo)}`);
                    const data = await response.json();

                    if (!data.success || !data.material) {
                        mostrarMensajeSimple(data.error || 'Material no encontrado', 'error');
                        return;
                    }

                    const material = data.material;
                    
                    rellenarCamposMaterial(material);
                    materialActual = material;
                    
                    limpiarVerificacion();
                    
                    const campoVerificacion = document.getElementById('salida_verificacion_codigo');
                    if (campoVerificacion) {
                        setTimeout(() => {
                            campoVerificacion.focus();
                        }, 300);
                    }
                    
                } catch (error) {
                    console.error('Error:', error);
                    mostrarMensajeSimple('Error al buscar material', 'error');
                }
            }
        }

        // Nueva función para procesar verificación de salida
        function procesarVerificacion(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                
                const codigoVerificacion = event.target.value.trim();
                
                if (!codigoVerificacion) {
                    return;
                }
                
                if (!materialActual) {
                    mostrarMensajeSimple('Primero debe escanear un material', 'error');
                    event.target.value = '';
                    return;
                }
                
                const coincidencias = verificarCoincidencias(codigoVerificacion, materialActual);
                
                if (coincidencias.length > 0) {
                    mostrarMensajeSimple(`✅ Verificado: ${coincidencias.join(', ')}`, 'success');
                    verificacionCompletada = true;
                    
                    event.target.style.border = '2px solid #27ae60';
                    event.target.readOnly = true;
                    
                    const checkbox = document.getElementById('salida_registroAutomatico');
                    const registroAutomatico = checkbox ? checkbox.checked : false;
                    
                    if (registroAutomatico) {
                        setTimeout(async () => {
                            await procesarSalidaAutomaticaDespuesVerificacion();
                        }, 500);
                    } else {
                        mostrarMensajeSimple('Verificación completada - Haga clic en "Guardar Salida"', 'info');
                    }
                    
                } else {
                    mostrarMensajeSimple('❌ Código no coincide con el material', 'error');
                    verificacionCompletada = false;
                    event.target.value = '';
                    event.target.focus();
                }
            }
        }

        // Función para verificar coincidencias entre el código escaneado y los datos del material
        function verificarCoincidencias(codigoVerificacion, material) {
            const coincidencias = [];
            
            const camposAVerificar = [
                { campo: 'codigo_material_recibido', nombre: 'Código Recibido' },
                { campo: 'codigo_material', nombre: 'Código Material' },
                { campo: 'codigo_material_original', nombre: 'Código Original' },
                { campo: 'numero_parte', nombre: 'Número de Parte' },
                { campo: 'numero_lote_material', nombre: 'Lote' }
            ];
            
            camposAVerificar.forEach(item => {
                const valorCampo = material[item.campo];
                if (valorCampo && codigoVerificacion.includes(valorCampo)) {
                    coincidencias.push(item.nombre);
                }
                if (valorCampo && valorCampo.includes(codigoVerificacion)) {
                    if (!coincidencias.includes(item.nombre)) {
                        coincidencias.push(item.nombre);
                    }
                }
            });
            
            return coincidencias;
        }

        // Función para limpiar verificación cuando se cambie de material
        function limpiarVerificacion() {
            const campoVerificacion = document.getElementById('salida_verificacion_codigo');
            
            if (campoVerificacion) {
                campoVerificacion.value = '';
                campoVerificacion.style.border = '2px solid #e74c3c';
                campoVerificacion.readOnly = false;
            }
            
            verificacionCompletada = false;
        }

        // Función para rellenar campos del material
        function rellenarCamposMaterial(material) {
            const campos = [
                'salida_codigo_material_original',
                'salida_codigo_material', 
                'salida_especificacion_material',
                'salida_numero_parte',
                'salida_cantidad_actual',
                'salida_numero_lote_material'
            ];
            
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                const propiedad = campoId.replace('salida_', '');
                if (campo && material[propiedad]) {
                    campo.value = material[propiedad];
                }
            });
        }

        // Nueva función para procesamiento automático después de verificación exitosa
        async function procesarSalidaAutomaticaDespuesVerificacion() {
            try {
                const codigo = document.getElementById('salida_codigo_material_recibido')?.value?.trim();
                
                if (!codigo || !materialActual || !verificacionCompletada) {
                    mostrarMensajeSimple('Error: faltan datos para procesar salida', 'error');
                    return;
                }
                
                const modelo = document.getElementById('salida_modelo')?.value || 'SIN_MODELO';
                const cantidadSalida = parseFloat(materialActual.cantidad_actual) || 0;

                if (cantidadSalida <= 0) {
                    mostrarMensajeSimple('Sin stock disponible', 'error');
                    return;
                }

                const salidaResponse = await fetch('/procesar_salida_material', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        codigo_material_recibido: codigo,
                        cantidad_salida: cantidadSalida,
                        modelo: modelo,
                        numero_lote: materialActual.numero_lote_material || '',
                        fecha_salida: document.getElementById('salida_fecha_salida_form')?.value || '',
                        depto_salida: 'Producción',
                        proceso_salida: 'SMT 1st SIDE',
                        codigo_verificacion: document.getElementById('salida_verificacion_codigo')?.value || ''
                    })
                });

                const salidaData = await salidaResponse.json();

                if (salidaData.success) {
                    const modeloTexto = modelo === 'SIN_MODELO' ? ' (sin modelo)' : ` (${modelo})`;
                    mostrarMensajeSimple(`✅ Salida automática procesada: ${cantidadSalida}${modeloTexto}`, 'success');
                    
                    setTimeout(() => {
                        limpiarCamposMaterial();
                    }, 1000);
                    
                } else {
                    mostrarMensajeSimple('Error al procesar salida automática', 'error');
                }
                
            } catch (error) {
                console.error('❌ Error en procesamiento automático:', error);
                mostrarMensajeSimple('Error interno en procesamiento automático', 'error');
            }
        }

        // Nueva función para procesamiento manual con botón
        async function procesarSalidaManual() {
            const codigo = document.getElementById('salida_codigo_material_recibido')?.value?.trim();
            
            if (!codigo) {
                mostrarMensajeSimple('Ingrese código de material', 'error');
                return;
            }
            
            if (!materialActual) {
                mostrarMensajeSimple('Primero busque el material escaneando o escribiendo código', 'error');
                return;
            }
            
            if (!verificacionCompletada) {
                mostrarMensajeSimple('Debe completar la verificación de salida primero', 'error');
                return;
            }
            
            try {
                const modelo = document.getElementById('salida_modelo')?.value || 'SIN_MODELO';
                const cantidadSalida = parseFloat(materialActual.cantidad_actual) || 0;

                if (cantidadSalida <= 0) {
                    mostrarMensajeSimple('Sin stock disponible', 'error');
                    return;
                }

                const salidaResponse = await fetch('/procesar_salida_material', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        codigo_material_recibido: codigo,
                        cantidad_salida: cantidadSalida,
                        modelo: modelo,
                        numero_lote: materialActual.numero_lote_material || '',
                        fecha_salida: document.getElementById('salida_fecha_salida_form')?.value || '',
                        depto_salida: 'Producción',
                        proceso_salida: 'SMT 1st SIDE',
                        codigo_verificacion: document.getElementById('salida_verificacion_codigo')?.value || ''
                    })
                });

                const salidaData = await salidaResponse.json();

                if (salidaData.success) {
                    const modeloTexto = modelo === 'SIN_MODELO' ? ' (sin modelo)' : ` (${modelo})`;
                    mostrarMensajeSimple(`Salida procesada: ${cantidadSalida}${modeloTexto} | Inventario actualizándose`, 'success');
                    
                    setTimeout(() => {
                        limpiarCamposMaterial();
                    }, 1500);
                    
                } else {
                    mostrarMensajeSimple('Error al procesar salida manual', 'error');
                }
                
            } catch (error) {
                console.error('❌ Error en procesamiento manual:', error);
                mostrarMensajeSimple('Error interno en procesamiento manual', 'error');
            }
        }

        // Función para limpiar campos del material
        function limpiarCamposMaterial() {
            const campos = [
                'salida_codigo_material_recibido',
                'salida_codigo_material_original',
                'salida_codigo_material', 
                'salida_especificacion_material',
                'salida_numero_parte',
                'salida_cantidad_actual',
                'salida_numero_lote_material'
            ];
            
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.value = '';
                }
            });
            
            limpiarVerificacion();
            materialActual = null;
            
            const codigoInput = document.getElementById('salida_codigo_material_recibido');
            if (codigoInput) {
                setTimeout(() => codigoInput.focus(), 100);
            }
        }

        // Función para mostrar mensajes simples
        function mostrarMensajeSimple(mensaje, tipo) {
            const colores = {
                success: '#27ae60',
                error: '#e74c3c',
                info: '#3498db',
                warning: '#f39c12'
            };
            
            const div = document.createElement('div');
            div.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colores[tipo] || '#3498db'};
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                z-index: 10000;
                font-size: 14px;
                max-width: 300px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            `;
            div.textContent = mensaje;
            
            document.body.appendChild(div);
            
            setTimeout(() => {
                div.remove();
            }, 3000);
        }

        // Funciones dummy para evitar errores
        function mostrarRegistroSalida() {
            console.log('Mostrando registro de salida');
        }
        
        function mostrarHistorialSalida() {
            console.log('Mostrando historial de salida');
        }
        
        function cargarModelosBOM() {
            console.log('Cargando modelos BOM');
        }
        
        function filtrarModelosSalida() {
            console.log('Filtrando modelos');
        }
        
        function mostrarDropdownSalida() {
            console.log('Mostrando dropdown');
        }
        
        function actualizarCantidadesPlan() {
            console.log('Actualizando cantidades plan');
        }
        
        function consultarSalidas() {
            console.log('Consultando salidas');
        }
        
        function limpiarFiltros() {
            console.log('Limpiando filtros');
        }
        
        function exportarExcel() {
            console.log('Exportando Excel');
        }
        
        // ===============================================
        // FIN CONTROL DE SALIDA - FUNCIONES EMBEBIDAS
        // ===============================================
</script>
</div>
</body>
</html>
