<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ilsan Electronics</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Font LG Regular -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yahirmonogatari/lg-fonts/lg-regular.css">
    <link rel="stylesheet" href="..\static\style.css">
    
</head>
<body>
    <header class="app-header">
        <button class="sidebar-toggle">
            <i class="bi bi-list"></i>
        </button>
        
        <div class="logo-container">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Ilsan Electronics Logo" class="logo">
            <br><div class="welcome">Bienvenido, {{ usuario }}</div>
        </div>
        
        <div class="nav-tabs-container">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#material">
                        <i class="bi bi-box-seam nav-icon"></i><br>
                        <span class="d-none d-md-inline">Control de material</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#produccion">
                        <i class="bi bi-cpu nav-icon"></i><br>
                        <span class="d-none d-md-inline">Control de producción</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#proceso">
                        <i class="bi bi-gear nav-icon"></i><br>
                        <span class="d-none d-md-inline">Control de proceso</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#calidad">
                        <i class="bi bi-check-circle nav-icon"></i><br>
                        <span class="d-none d-md-inline">Control de calidad</span>
                    </a>
                </li>
            </ul>
        </div>
    </header>

    <div class="app-container">
        <aside class="app-sidebar">
            <ul class="sidebar-menu">
                <li class="sidebar-section">
                    <button class="sidebar-dropdown-btn" data-bs-toggle="collapse" data-bs-target="#sidebarMaterial">
                        <span class="sidebar-icon"></span>
                        Control de material
                        <span class="sidebar-caret"><i class="bi bi-chevron-down"></i></span>
                    </button>
                    <ul class="collapse sidebar-dropdown-list" id="sidebarMaterial">
                        <li class="sidebar-link">   Control de material de almacén</li>
                        <li class="sidebar-link">Control de salida</li>
                        <li class="sidebar-link">Control de material retorno</li>
                        <li class="sidebar-link">Recibo y pago del material</li>
                        <li class="sidebar-link">Historial de material</li>
                        <li class="sidebar-link">Estatus de material</li>
                        <li class="sidebar-link">Material sustituto</li>
                        <li class="sidebar-link">Consultar PEPS</li>
                        <li class="sidebar-link">Control de Long-Term Inventory</li>
                        <li class="sidebar-link">Registro de material real</li>
                        <li class="sidebar-link">Historial de inventario real</li>
                        <li class="sidebar-link">Ajuste de número de parte</li>
                    </ul>
                </li>
                <li class="sidebar-section">
                    <button class="sidebar-dropdown-btn" data-bs-toggle="collapse" data-bs-target="#sidebarMSL">
                        <span class="sidebar-icon"><i class="bi bi-box-seam"></i></span>
                        Control de material MSL
                        <span class="sidebar-caret"><i class="bi bi-chevron-down"></i></span>
                    </button>
                    <ul class="collapse sidebar-dropdown-list" id="sidebarMSL">
                        <li class="sidebar-link">Control total de material</li>
                        <li class="sidebar-link">Control de entrada y salida de material</li>
                        <li class="sidebar-link">Estatus de material MSL</li>
                    </ul>
                </li>
                <li class="sidebar-section">
                    <button class="sidebar-dropdown-btn" data-bs-toggle="collapse" data-bs-target="#sidebarRefacciones">
                        <span class="sidebar-icon"><i class="bi bi-box-seam"></i></span>
                        Control de refacciones
                        <span class="sidebar-caret"><i class="bi bi-chevron-down"></i></span>
                    </button>
                    <ul class="collapse sidebar-dropdown-list" id="sidebarRefacciones">
                        <li class="sidebar-link">Estándares sobre refacciones</li>
                        <li class="sidebar-link">Control de recibo de refacciones</li>
                        <li class="sidebar-link">Control de salida de refacciones</li>
                        <li class="sidebar-link">Estatus de inventario de refacciones</li>
            </ul>
        </aside>

        <div class="overlay"></div>

        <main class="app-content"> 
        </main>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.querySelector('.app-sidebar');
            const sidebarToggle = document.querySelector('.sidebar-toggle');
            const overlay = document.querySelector('.overlay');
            
            // Toggle sidebar on mobile
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            });
            
            // Close sidebar when clicking on overlay
            overlay.addEventListener('click', function() {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            });
            
            // Activar tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Manejar el contenido dinámico
            const mainContent = document.querySelector('.app-content');
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            const entradaTemplate = `
                <div id="material" class="tab-pane_active">
                  <h2>Entrada de Aéreo</h2>
                  <div class="form-container">
                    <div class="form-row">
                      <div class="form-group">
                        <label for="formaMaterial">Forma de material</label>
                        <select id="formaMaterial">
                          <option>OriginCode</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="cliente">Cliente</label>
                        <select id="cliente">
                          <option>Seleccionar</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="codigoMaterial">Código de material</label>
                        <input id="codigoMaterial" type="text" class="form_global">
                      </div>
                      <div class="form-group">
                        <label for="fechaFab">Fecha fabricación</label>
                        <input id="fechaFab" type="date">
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group">
                        <label for="origenMaterial">Material importación/local</label>
                        <select id="origenMaterial">
                          <option>Customer Supply</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="cantidadActual">Cantidad actual</label>
                        <input id="cantidadActual" type="number">
                      </div>
                      <div class="form-group">
                        <label for="fechaRecibo">Fecha de recibo</label>
                        <input id="fechaRecibo" type="date">
                      </div>
                      <div class="form-group">
                        <label for="loteMaterial">No. lote material</label>
                        <input id="loteMaterial" type="text">
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group">
                        <label for="codRecibido">Código material recibido</label>
                        <input id="codRecibido" type="text">
                      </div>
                      <div class="form-group">
                        <label for="numParte">Número de parte</label>
                        <input id="numParte" type="text">
                      </div>
                      <div class="form-group">
                        <label for="propiedad">Propiedad material</label>
                        <input type="text" id="propiedad" name="propiedad" class="form-group">
                      </div>
                    </div>
                  </div>

                  <div class="action-buttons">
                    <button id="guardarEntrada" type="button" class="btn btn-secondary">Guardar</button>
                    <button type="button" class="btn btn-secondary">Imprimir</button>
                    <button type="button" class="btn btn-secondary">Consultar</button>
                    <button type="button" class="btn btn-success">Exportar a Excel</button>
                  </div>

                  <table class="data-table">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Forma material</th>
                        <th>Cliente</th>
                        <th>Código material</th>
                        <th>Fecha fabricación</th>
                        <th>Origen material</th>
                        <th>Cantidad actual</th>
                        <th>Fecha recibo</th>
                        <th>No. lote material</th>
                        <th>Código recibido</th>
                        <th>Número parte</th>
                        <th>Propiedad</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="no-data">
                        <td colspan="12">No hay datos registrados</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
            `;
            function cargarEntradasAereo() {
                fetch('/listar_entradas_aereo')
                    .then(r => r.json())
                    .then(data => {
                        const tbody = mainContent.querySelector('.data-table tbody');
                        if (!tbody) return;
                        tbody.innerHTML = '';
                        if (data.length === 0) {
                            const tr = document.createElement('tr');
                            tr.classList.add('no-data');
                            tr.innerHTML = '<td colspan="12">No hay datos registrados</td>';
                            tbody.appendChild(tr);
                        } else {
                            data.forEach((row, idx) => {
                                const tr = document.createElement('tr');
                                tr.innerHTML = `
                                    <td>${idx + 1}</td>
                                    <td>${row.forma_material || ''}</td>
                                    <td>${row.cliente || ''}</td>
                                    <td>${row.codigo_material || ''}</td>
                                    <td>${row.fecha_fabricacion || ''}</td>
                                    <td>${row.origen_material || ''}</td>
                                    <td>${row.cantidad_actual || ''}</td>
                                    <td>${row.fecha_recibo || ''}</td>
                                    <td>${row.lote_material || ''}</td>
                                    <td>${row.codigo_recibido || ''}</td>
                                    <td>${row.numero_parte || ''}</td>
                                    <td>${row.propiedad || ''}</td>
                                `;
                                tbody.appendChild(tr);
                            });
                        }
                    });
            }

            const salidaTemplate = `
                <!-- Pestaña “Salida” -->
                <div id="tab-salida" class="tab-pane fade show" role="tabpanel" aria-labelledby="salida-tab">
                  <!-- Formulario superior -->
                  <form id="form-salida" class="mb-4">
                    <div class="row g-3 align-items-end">
                      <!-- Número de lote -->
                      <div class="form-group">
                        <label for="lote" class="form-group">Número de lote</label>
                        <input type="text" id="lote" class="form-group">
                      </div>
                      <!-- Checkboxes BOM / PEPS -->
                      <div class="col-md-3 d-flex">
                        <div class="form-check me-3">
                          <input class="form-check-input" type="checkbox" id="verif-bom">
                          <label class="form-check-label text-light" for="verif-bom">Verificación de BOM</label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="peps">
                          <label class="form-check-label text-light" for="peps">PEPS</label>
                        </div>
                      </div>
                      <!-- Modelo -->
                      <div class="col-md-2">
                        <label for="modelo" class="form-label text-light">Modelo</label>
                        <select id="modelo" class="form-select">
                          <option>Seleccionar</option>
                          <!-- Opciones dinámicas -->
                        </select>
                      </div>
                      <!-- Departamento de salida -->
                      <div class="col-md-2">
                        <label for="depto-salida" class="form-label text-light">Departamento de salida</label>
                        <select id="depto-salida" class="form-select">
                          <option>Seleccionar</option>
                        </select>
                      </div>
                      <!-- Proceso de salida -->
                      <div class="col-md-2">
                        <label for="proceso-salida" class="form-label text-light">Proceso de salida</label>
                        <select id="proceso-salida" class="form-select">
                          <option>Seleccionar</option>
                        </select>
                      </div>
                    </div>

                    <div class="row g-3 align-items-end mt-2">
                      <!-- Código de material recibido -->
                      <div class="col-md-4">
                        <label for="cod-recibido" class="form-label text-light">Código de material recibido</label>
                        <input type="text" id="cod-recibido" class="form-group">
                      </div>
                      <!-- Validación de código original -->
                      <div class="col-md-4 d-flex align-items-center">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="val-cod-original">
                          <label class="form-check-label text-light" for="val-cod-original">Validación de código original</label>
                        </div>
                      </div>
                      <!-- Código de material original -->
                      <div class="col-md-4">
                        <label for="cod-original" class="form-label text-light">Código de material original</label>
                        <input type="text" id="cod-original" class="form-group bg-primary text-white">
                      </div>
                    </div>
                  </form>

                  <!-- Panel morado con detalles -->
                  <div class="p-3 mb-4 rounded" style="background-color: #5d417e;">
                    <div class="row g-3">
                      <div class="col-md-2">
                        <label class="form-label text-light">Código de material</label>
                        <input type="text" class="form-group">
                      </div>
                      <div class="col-md-2">
                        <label class="form-label text-light">Número de parte</label>
                        <input type="text" class="form-group">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label text-light">Especificación de material</label>
                        <input type="text" class="form-group">
                      </div>
                      <div class="col-md-2">
                        <label class="form-label text-light">Cantidad actual</label>
                        <input type="number" class="form-group">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label text-light">Número de lote de material</label>
                        <input type="text" class="form-group">
                      </div>
                    </div>
                  </div>

                  <!-- Botones Reiniciar / Guardar -->
                  <div class="d-flex justify-content-end mb-3">
                    <button type="button" class="btn btn-secondary me-2">Reiniciar</button>
                    <button type="button" class="btn btn-warning">Guardar</button>
                  </div>

                  <!-- Pestañas Registro / Historial -->
                  <ul class="nav nav-tabs" id="salidaTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" id="registro-tab" data-bs-toggle="tab" data-bs-target="#registro" type="button" role="tab" aria-controls="registro" aria-selected="true">Registro de salida</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" id="historial-tab" data-bs-toggle="tab" data-bs-target="#historial" type="button" role="tab" aria-controls="historial" aria-selected="false">Historial de salida</button>
                    </li>
                  </ul>
                  <div class="tab-content mt-3" id="salidaTabsContent">
                    <!-- Registro de salida -->
                    <div class="tab-pane fade show active" id="registro" role="tabpanel" aria-labelledby="registro-tab">
                      <div class="row">
                        <!-- Tabla izquierda -->
                        <div class="col-md-6">
                          <table class="table table-dark table-striped table-sm">
                            <thead>
                              <tr>
                                <th>Proceso</th>
                                <th>Código</th>
                                <th>Número de parte</th>
                                <th>Cant. de...</th>
                                <th>Cant. total</th>
                                <th>Propiedad</th>
                              </tr>
                            </thead>
                            <tbody>
                              <!-- Filas dinámicas -->
                            </tbody>
                          </table>
                        </div>
                        <!-- Tabla derecha -->
                        <div class="col-md-6">
                          <table class="table table-dark table-striped table-sm">
                            <thead>
                              <tr>
                                <th>Código d...</th>
                                <th>Código d...</th>
                                <th>Número...</th>
                                <th>Cantidad</th>
                                <th>Número...</th>
                                <th>Propiedad</th>
                                <th>Nivel de...</th>
                                <th>Especif...</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td colspan="8" class="text-center text-secondary">No hay data registrado</td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                    <!-- Historial de salida -->
                    <div class="tab-pane fade" id="historial" role="tabpanel" aria-labelledby="historial-tab">
                      <!-- Aquí va tu tabla o contenido de historial -->
                    </div>
                  </div>
                </div>
            `;

            sidebarLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mainContent.innerHTML = '';
                    // Cerrar sidebar en móviles al seleccionar un item
                    if (window.innerWidth < 768) {
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                    }
                    
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    if (this.textContent.trim() === 'Control de material de almacén') {
                        mainContent.innerHTML = entradaTemplate;
                        cargarEntradasAereo();
                        const btn = mainContent.querySelector('#guardarEntrada');
                        if (btn) {
                            btn.addEventListener('click', function() {
                                const payload = {
                                    formaMaterial: document.getElementById('formaMaterial').value,
                                    cliente: document.getElementById('cliente').value,
                                    codigoMaterial: document.getElementById('codigoMaterial').value,
                                    fechaFab: document.getElementById('fechaFab').value,
                                    origenMaterial: document.getElementById('origenMaterial').value,
                                    cantidadActual: document.getElementById('cantidadActual').value,
                                    fechaRecibo: document.getElementById('fechaRecibo').value,
                                    loteMaterial: document.getElementById('loteMaterial').value,
                                    codRecibido: document.getElementById('codRecibido').value,
                                    numParte: document.getElementById('numParte').value,
                                    propiedad: document.getElementById('propiedad').value
                                };
                                fetch('/guardar_entrada_aereo', {
                                    method: 'POST',
                                    headers: {'Content-Type': 'application/json'},
                                    body: JSON.stringify(payload)
                                })
                                .then(r => r.json())
                                .then(resp => {
                                    if (resp.success) {
                                        alert('Registro guardado');
                                        cargarEntradasAereo();
                                    } else {
                                        alert('Error al guardar');
                                    }
                                });
                            });
                        }
                    } else if (this.textContent.trim() === 'Control de salida') {
                        mainContent.innerHTML = salidaTemplate;   
                    } else {
                        mainContent.innerHTML = '';
                    }
                });
            });
            
            // Manejar tabs del header
            const tabLinks = document.querySelectorAll('.nav-tabs .nav-link');
            tabLinks.forEach(link => {
                link.addEventListener('click', function() {
                    // Mostrar/ocultar sidebar según la pestaña seleccionada
                    mainContent.innerHTML = "";
                    if (this.getAttribute('href') === '#info') {
                        sidebar.style.display = 'block';
                    } else if (this.getAttribute('href') === '#material') {
                        sidebar.style.display = 'block';
                        // Mostrar todas las secciones de material
                        document.querySelectorAll('.sidebar-section').forEach(sec => {
                            sec.style.display = 'none';
                        });
                        ['#sidebarMaterial', '#sidebarMSL', '#sidebarRefacciones'].forEach(id => {
                            const sec = document.querySelector(id);
                            if (sec) sec.closest('.sidebar-section').style.display = 'block';
                        });
                    } else {
                        sidebar.style.display = 'none';
                    }
                });
            });
            
            // Ajustar el contenido cuando se redimensiona la ventana
            function handleResize() {
                if (window.innerWidth >= 768) {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                }
            }
            
            window.addEventListener('resize', handleResize);
        });
    </script>
</body>
</html>