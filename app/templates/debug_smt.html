<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Debug SMT</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .debug-info {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        .error {
            background-color: #ffe7e7;
            border-left-color: #dc3545;
        }
        .success {
            background-color: #e7ffe7;
            border-left-color: #28a745;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            background-color: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-box {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            min-width: 120px;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>üîç Debug - Visualizaci√≥n de Datos SMT</h1>
    
    <div class="debug-info">
        <h3>üìä Informaci√≥n de Debug</h3>
        <p><strong>Endpoint:</strong> /api/smt/historial/data</p>
        <p><strong>Filtro aplicado:</strong> folder={{ request.args.get('folder', 'ninguno') }}</p>
        <p><strong>Timestamp:</strong> {{ timestamp }}</p>
    </div>

    <div class="stats">
        <div class="stat-box">
            <div class="stat-number">{{ total_registros }}</div>
            <div class="stat-label">Total Registros</div>
        </div>
        <div class="stat-box">
            <div class="stat-number">{{ ok_count }}</div>
            <div class="stat-label">OK</div>
        </div>
        <div class="stat-box">
            <div class="stat-number">{{ ng_count }}</div>
            <div class="stat-label">NG</div>
        </div>
    </div>

    {% if error %}
    <div class="debug-info error">
        <h3>‚ùå Error</h3>
        <p>{{ error }}</p>
    </div>
    {% endif %}

    {% if registros %}
    <div class="debug-info success">
        <h3>‚úÖ Datos encontrados</h3>
        <p>Se encontraron {{ registros|length }} registros en la base de datos</p>
    </div>

    <h3>üìã Datos de la tabla historial_cambio_material_smt</h3>
    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>L√≠nea</th>
                    <th>M√°quina</th>
                    <th>Slot</th>
                    <th>Resultado</th>
                    <th>LOT NO</th>
                    <th>Barcode</th>
                    <th>Archivo</th>
                    <th>Part Name</th>
                    <th>Quantity</th>
                </tr>
            </thead>
            <tbody>
                {% for reg in registros %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ reg.ScanDate }}</td>
                    <td>{{ reg.ScanTime }}</td>
                    <td>{{ reg.linea }}</td>
                    <td>{{ reg.maquina }}</td>
                    <td>{{ reg.SlotNo }}</td>
                    <td style="color: {% if reg.Result == 'OK' %}green{% else %}red{% endif %};">
                        {{ reg.Result }}
                    </td>
                    <td>{{ reg.LOTNO }}</td>
                    <td>{{ reg.Barcode }}</td>
                    <td>{{ reg.archivo }}</td>
                    <td>{{ reg.PartName }}</td>
                    <td>{{ reg.Quantity }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="debug-info error">
        <h3>‚ö†Ô∏è Sin datos</h3>
        <p>No se encontraron registros en la tabla historial_cambio_material_smt</p>
        <p>Posibles causas:</p>
        <ul>
            <li>La tabla est√° vac√≠a</li>
            <li>Los filtros son muy restrictivos</li>
            <li>Error en la consulta SQL</li>
        </ul>
    </div>
    {% endif %}

    <div class="debug-info">
        <h3>üîó Enlaces √∫tiles</h3>
        <p>
            <a href="/smt/debug">üîÑ Recargar</a> |
            <a href="/smt/debug?folder=1line">üè≠ Filtrar l√≠nea 1</a> |
            <a href="/smt/debug?folder=2line">üè≠ Filtrar l√≠nea 2</a> |
            <a href="/api/smt/historial/data" target="_blank">üîó Ver API JSON</a>
        </p>
    </div>
</body>
</html>
